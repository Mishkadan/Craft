!function(){var requirejs,require,define;!function(c){var n,a,p,u,m={},v={},g={},f={},i=Object.prototype.hasOwnProperty,s=[].slice,b=/\.js$/;function x(t,e){return i.call(t,e)}function l(t,e){var i,s,o,n,a,l,r,h,d,c,p=e&&e.split("/"),u=g.map,m=u&&u["*"]||{};if(t&&"."===t.charAt(0))if(e){for(p=p.slice(0,p.length-1),e=(t=t.split("/")).length-1,g.nodeIdCompat&&b.test(t[e])&&(t[e]=t[e].replace(b,"")),t=p.concat(t),h=0;h<t.length;h+=1)if("."===(c=t[h]))t.splice(h,1),--h;else if(".."===c){if(1===h&&(".."===t[2]||".."===t[0]))break;0<h&&(t.splice(h-1,2),h-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((p||m)&&u){for(h=(i=t.split("/")).length;0<h;--h){if(s=i.slice(0,h).join("/"),p)for(d=p.length;0<d;--d)if(o=(o=u[p.slice(0,d).join("/")])&&o[s]){n=o,a=h;break}if(n)break;!l&&m&&m[s]&&(l=m[s],r=h)}!n&&l&&(n=l,a=r),n&&(i.splice(0,a,n),t=i.join("/"))}return t}function w(t,e){return function(){return a.apply(c,s.call(arguments,0).concat([t,e]))}}function y(t){var e;if(x(v,t)&&(e=v[t],delete v[t],f[t]=!0,n.apply(c,e)),x(m,t)||x(f,t))return m[t];throw new Error("No "+t)}function r(t){var e,i=t?t.indexOf("!"):-1;return-1<i&&(e=t.substring(0,i),t=t.substring(i+1,t.length)),[e,t]}p=function(t,e){var i,s,o=r(t),n=o[0];return t=o[1],n&&(i=y(n=l(n,e))),n?t=i&&i.normalize?i.normalize(t,(s=e,function(t){return l(t,s)})):l(t,e):(n=(o=r(t=l(t,e)))[0],t=o[1],n&&(i=y(n))),{f:n?n+"!"+t:t,n:t,pr:n,p:i}},u={require:function(t){return w(t)},exports:function(t){var e=m[t];return void 0!==e?e:m[t]={}},module:function(t){return{id:t,uri:"",exports:m[t],config:(e=t,function(){return g&&g.config&&g.config[e]||{}})};var e}},n=function(t,e,i,s){var o,n,a,l,r,h=[],d=typeof i;if(s=s||t,"undefined"==d||"function"==d){for(e=!e.length&&i.length?["require","exports","module"]:e,l=0;l<e.length;l+=1)if("require"===(n=(a=p(e[l],s)).f))h[l]=u.require(t);else if("exports"===n)h[l]=u.exports(t),r=!0;else if("module"===n)o=h[l]=u.module(t);else if(x(m,n)||x(v,n)||x(f,n))h[l]=y(n);else{if(!a.p)throw new Error(t+" missing "+n);a.p.load(a.n,w(s,!0),function(e){return function(t){m[e]=t}}(n),{}),h[l]=m[n]}d=i?i.apply(m[t],h):void 0,t&&(o&&o.exports!==c&&o.exports!==m[t]?m[t]=o.exports:d===c&&r||(m[t]=d))}else t&&(m[t]=i)},requirejs=require=a=function(t,e,i,s,o){if("string"==typeof t)return u[t]?u[t](e):y(p(t,e).f);if(!t.splice){if((g=t).deps&&a(g.deps,g.callback),!e)return;e.splice?(t=e,e=i,i=null):t=c}return e=e||function(){},"function"==typeof i&&(i=s,s=o),s?n(c,t,e,i):setTimeout(function(){n(c,t,e,i)},4),a},a.config=function(t){return a(t)},requirejs._defined=m,(define=function(t,e,i){e.splice||(i=e,e=[]),x(m,t)||x(v,t)||(v[t]=[t,e,i])}).amd={jQuery:!0}}(),define("../../vendors/almond",function(){}),define("jst",[],function(){window.joms=window.joms||{},window.joms.jst=window.joms.jst||{},window.joms.jst["html/dropdown/location-list"]=function(t){var e,i="";_.escape,Array.prototype.join;if(t&&t.items&&t.items.length)for(var s=0;s<t.items.length;s++)i+=' <li data-index="'+(null==(e=s)?"":e)+'"> <p style="margin:0">'+(null==(e=t.items[s].name)?"":e)+"</p> <span>"+(null==(e=t.items[s].vicinity||t.language.geolocation.near_here)?"":e)+"</span> </li> ";else i+=" <li><em>"+(null==(e=t.language.geolocation.empty)?"":e)+"</em></li> ";return i},window.joms.jst["html/dropdown/location"]=function(t){var e,i="";_.escape;return i+='<div class="joms-postbox-dropdown location-dropdown"> <div class=joms-postbox-map></div> <div class="joms-postbox-action joms-location-action" style="z-index:99999"> <button class=joms-add-location><i class=joms-icon-map-marker></i>'+(null==(e=t.language.geolocation.select_button)?"":e)+"</button> <button class=joms-remove-location><i class=joms-icon-remove></i>"+(null==(e=t.language.geolocation.remove_button)?"":e)+'</button> </div> <input class="joms-postbox-keyword joms-input" type=text> <ul class=joms-postbox-locations></ul> </div>'},window.joms.jst["html/dropdown/mood"]=function(t){var e,i="";_.escape,Array.prototype.join;if(i+='<div class="joms-postbox-dropdown mood-dropdown"> <ul class="joms-postbox-emoticon joms-list clearfix"> ',t&&t.items&&t.items.length)for(var s=0;s<t.items.length;s++)i+=' <li data-mood="'+(null==(e=t.items[s][0])?"":e)+'"> ',void 0!==t.items[s][2]?i+=' <div><img class=joms-emoticon src="'+(null==(e=t.items[s][2])?"":e)+'"><span>'+(null==(e=t.items[s][1])?"":e)+"</span></div> ":i+=' <div><i class="joms-emoticon joms-emo-'+(null==(e=t.items[s][0])?"":e)+'"></i><span>'+(null==(e=t.items[s][1])?"":e)+"</span></div> ",i+=" </li> ";return i+=" <li class=joms-remove-button>"+(null==(e=t.language.status.remove_mood_button)?"":e)+"</li> </ul> </div>"},window.joms.jst["html/dropdown/privacy"]=function(t){var e,i="";_.escape,Array.prototype.join;if(i+='<div class="joms-postbox-dropdown privacy-dropdown"> <ul class=joms-list> ',t&&t.items&&t.items.length)for(var s=0;s<t.items.length;s++)i+=' <li data-priv="'+(null==(e=t.items[s][0])?"":e)+'"> <p class=reset-gap><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+"#joms-icon-"+(null==(e=t.items[s][1])?"":e)+'"></use></svg> '+(null==(e=t.items[s][2])?"":e)+"</p> <span>"+(null==(e=t.items[s][3])?"":e)+"</span> </li> ";return i+=" </ul> </div>"},window.joms.jst["html/inputbox/eventdesc"]=function(t){var e="";_.escape;return e+='<div style="position:relative"> <div class="joms-postbox-input joms-inputbox"> <div class=inputbox> <div style="position:relative" class="joms-textarea__wrapper"> <div style="position:relative"><span class=input></span></div> <textarea class="input joms-textarea" placeholder="'+(null==(t=t&&t.placeholder||"")?"":t)+'" style="min-height:1.4em"></textarea> </div> </div> </div> <div class="joms-icon joms-icon--emoticon" style="top:20px; right: 5px;"><div style="position:relative"><svg viewBox="0 0 16 16" onclick="joms.view.comment.showEmoticonBoard(this);"><use xlink:href="'+window.joms_current_url+'#joms-icon-smiley"></use></svg></div></div> <div class="charcount joms-postbox-charcount"></div> </div>'},window.joms.jst["html/inputbox/eventtitle"]=function(t){var e="";_.escape;return e+='<div style="position:relative"> <div class="joms-postbox-input joms-inputbox" style="padding:0; border-bottom:0; min-height:0"> <div class=inputbox> <div style="position:relative"> <div style="position:relative"><span class=input></span></div> <textarea class="input joms-textarea"  placeholder="'+(null==(t=t&&t.placeholder||"")?"":t)+'" style="min-height:1.4em"></textarea> </div> </div> </div> </div>'},window.joms.jst["html/inputbox/base"]=function(t){var e="";_.escape;return e+='<div style="position:relative"> <div class="joms-postbox-input joms-inputbox"> <div class=inputbox> <div style="position:relative"> <div style="position:relative"><span class=input></span></div> <div class=joms-textarea__wrapper><textarea class="input input-photo-desc joms-textarea" placeholder="'+(null==(t=t&&t.placeholder||"")?"":t)+'" style="min-height:1.4em"></textarea></div> </div> </div> </div> <div class="joms-icon joms-icon--emoticon" style="top:20px; right: 5px;"><div style="position:relative"><svg viewBox="0 0 16 16" onclick="joms.view.comment.showEmoticonBoard(this);"><use xlink:href="'+window.joms_current_url+'#joms-icon-smiley"></use></svg></div></div> <div class="charcount joms-postbox-charcount"></div> </div>'},window.joms.jst["html/inputbox/video"]=function(t){var e="";_.escape;return e+='<div style="position:relative"> <div class="joms-postbox-input joms-inputbox"> <div class=inputbox> <div style="position:relative"> <div style="position:relative"><span class=input></span></div> <div class=joms-textarea__wrapper><textarea class="input joms-postbox-video-description joms-textarea" placeholder="'+(null==(t=t&&t.placeholder||"")?"":t)+'" style="min-height:1.4em"></textarea></div> </div> </div> </div> <div class="joms-icon joms-icon--emoticon" style="top:20px; right: 5px;"><div style="position:relative"><svg viewBox="0 0 16 16" onclick="joms.view.comment.showEmoticonBoard(this);"><use xlink:href="'+window.joms_current_url+'#joms-icon-smiley"></use></svg></div></div> <div class="charcount joms-postbox-charcount"></div> </div>'},window.joms.jst["html/inputbox/videourl"]=function(t){var e="";_.escape;return e+='<div style="position:relative"> <div class="joms-postbox-input joms-inputbox" style="padding:0; border-bottom:0; min-height:0"> <div class=inputbox> <div style="position:relative"> <div style="position:relative"><span class=input></span></div> <textarea class="input joms-textarea joms-postbox-video-url" placeholder="'+(null==(t=t&&t.placeholder||"")?"":t)+'" style="min-height:1.4em"></textarea> </div> </div> </div> </div>'},window.joms.jst["html/postbox/custom"]=function(t){var e,i="";_.escape,Array.prototype.join;if(i+='<div> <div class=joms-postbox-inner-panel> <div class=joms-postbox-double-panel> <ul class="joms-list clearfix"> <li class=joms-postbox-predefined-message><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-cog"></use></svg> '+(null==(e=t.language.custom.predefined_button)?"":e)+'</li> <li class=joms-postbox-custom-message><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-pencil"></use></svg> '+(null==(e=t.language.custom.custom_button)?"":e)+"</li> </ul> </div> </div> <div class=joms-postbox-custom> <div class=joms-postbox-custom-state-predefined> <div class=joms-postbox-inner-panel> <span>"+(null==(e=t.language.custom.predefined_label)?"":e)+'</span><br> <select name=predefined style="width: 100%"> ',t&&t.messages&&t.messages.length){i+=" ";for(var s=0;s<t.messages.length;s++)i+=' <option value="'+(null==(e=t.messages[s][0])?"":e)+'">'+(null==(e=t.messages[s][1])?"":e)+"</option> ";i+=" "}return i+=" </select> </div> </div> <div class=joms-postbox-custom-state-custom> <div class=joms-postbox-inner-panel> <span>"+(null==(e=t.language.custom.custom_label)?"":e)+'</span><br> <textarea name=custom></textarea> </div> </div> <nav class="joms-postbox-tab selected"> <ul class="joms-list inline"> <li data-tab=privacy><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-earth"></use></svg> <span class=visible-desktop></span></li> </ul> <div class=joms-postbox-action> <button class=joms-postbox-cancel>'+(null==(e=t.language.postbox.cancel_button)?"":e)+"</button> <button class=joms-postbox-save>"+(null==(e=t.language.postbox.post_button)?"":e)+'</button> </div> <div class=joms-postbox-loading style="display:none;"> <img src="'+(null==(e=t.juri.root)?"":e)+'components/com_community/assets/ajax-loader.gif" alt="loader"> <div </nav> <div class="joms-postbox-dropdown privacy-dropdown"></div> </div> </div>'},window.joms.jst["html/postbox/event"]=function(t){var e,i="";_.escape;return i+='<div class=joms-postbox-event> <div class=joms-postbox-inner-panel> <div class=joms-postbox-title></div> <div class=joms-postbox-event-detail> <div class="joms-postbox-event-panel joms-postbox-event-label-category" style="display:none"> <div class=joms-postbox-event-title style="padding-bottom:0;padding-top:8px"> <div class=joms-input-field-name>'+(null==(e=t.language.event.category)?"":e)+'</div> <span class=joms-input-text style="display:inline-block"></span> </div> </div> <div class="joms-postbox-event-panel joms-postbox-event-label-location" style="display:none"> <div class=joms-postbox-event-title style="padding-bottom:0;padding-top:8px"> <div class=joms-input-field-name>'+(null==(e=t.language.event.location)?"":e)+'</div> <span class=joms-input-text style="display:inline-block"></span> </div> </div> <div class="joms-postbox-event-panel joms-postbox-event-label-date" style="display:none"> <div class=joms-postbox-event-title style="padding-bottom:0;padding-top:8px"> <div class=joms-input-field-name>'+(null==(e=t.language.event.date_and_time)?"":e)+'</div> <span class=joms-input-text style="display:inline-block"></span> </div> </div> </div> </div> <div class=joms-postbox-inputbox></div> <nav class="joms-postbox-tab selected"> <ul class="joms-list inline"> <li data-tab=event><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-cog"></use></svg> <span class=visible-desktop>'+(null==(e=t.language.event.event_detail)?"":e)+"</span></li> </ul> <div class=joms-postbox-action> <button class=joms-postbox-cancel>"+(null==(e=t.language.postbox.cancel_button)?"":e)+"</button> <button class=joms-postbox-save>"+(null==(e=t.language.postbox.post_button)?"":e)+'</button> </div> <div class=joms-postbox-loading style="display:none;"> <img src="'+(null==(e=t.juri.root)?"":e)+'components/com_community/assets/ajax-loader.gif" alt="loader"> <div </nav> </div>'},window.joms.jst["html/postbox/fetcher-video"]=function(t){var e,i="",s=_.escape;Array.prototype.join;return i+="<div class=joms-fetched-wrapper> ",t.image&&(i+=' <div class=joms-fetched-images> <img src="'+(null==(e=t.image)?"":e)+'"> </div> '),i+=' <div class="joms-fetched-field joms-fetched-title"> <span style="font-weight:bold">'+(null==(e=t.title||t.titlePlaceholder)?"":e)+'</span> <input type=text class=joms-input value="'+(null==(e=s(t.title||""))?"":e)+'" style="display:none;margin:0"> </div> <div class="joms-fetched-field joms-fetched-description"> <span>'+(null==(e=t.description||t.descPlaceholder)?"":e)+'</span> <textarea class=joms-textarea style="display:none;margin:0">'+(null==(e=t.description||"")?"":e)+"</textarea> </div> <div class=clearfix></div> <span class=joms-fetched-close ><i class=joms-icon-remove></i>"+(null==(e=t.lang.cancel)?"":e)+'</span> <div style="padding-top:10px"> <div class="joms-fetched-category joms-select" style="padding:3px 0"></div> </div> </div>'},window.joms.jst["html/postbox/fetcher"]=function(t){var e,i="",s=_.escape;Array.prototype.join;if(i+='<div class=joms-postbox-inner-panel> <div style="position:relative"> <div class=joms-fetched-images> ',t.image&&t.image.length){i+=' <div style="height:120px"> ';for(var o=0;o<t.image.length;o++)i+=' <img src="'+(null==(e=t.image[o])?"":e)+'" style="width:100%;height:100%;'+(null==(e=o?"display:none":"")?"":e)+'"> ';i+=" </div> ",1<t.image.length&&(i+=' <div class=joms-fetched-nav style="text-align:center"> <span class=joms-fetched-previmg style="cursor:pointer">&laquo; '+(null==(e=t.lang.prev)?"":e)+'</span> &nbsp;&nbsp; <span class=joms-fetched-nextimg style="cursor:pointer">'+(null==(e=t.lang.next)?"":e)+" &raquo;</span> </div> "),i+=" "}else i+=' <div style="height:120px;width:120px;background-color:#F9F9F9;color:7F8C8D;text-align:center;vertical"> &nbsp;<br>&nbsp;<br>no<br>thumbnail </div> ';return i+=' </div> <div class="joms-fetched-field joms-fetched-title"> <span style="font-weight:bold">'+(null==(e=t.title||t.titlePlaceholder)?"":e)+'</span> <input type=text class=joms-input value="'+(null==(e=s(t.title||""))?"":e)+'" style="display:none;margin:0"> </div> <div class="joms-fetched-field joms-fetched-description"> <span>'+(null==(e=t.description||t.descPlaceholder)?"":e)+'</span> <textarea class=joms-textarea style="display:none;margin:0">'+(null==(e=t.description||"")?"":e)+'</textarea> </div> <div class=clearfix></div> <span class=joms-fetched-close style="top:0"><i class=joms-icon-remove></i>'+(null==(e=t.lang.cancel)?"":e)+"</span> </div> </div>"},window.joms.jst["html/postbox/photo-item"]=function(t){var e,i="";_.escape;return i+='<li id="'+(null==(e=t.id)?"":e)+'" class=joms-postbox-photo-item> <div class=img-wrapper> <img src="'+(null==(e=t.src)?"":e)+'" > </div> <div class=joms-postbox-photo-action style="display:none"> <span class=joms-postbox-photo-remove>×</span> </div> <div class=joms-postbox-photo-progressbar> <div class=joms-postbox-photo-progress></div> </div> </li>'},window.joms.jst["html/postbox/photo-preview"]=function(t){_.escape;return'<div class=joms-postbox-photo-preview> <ul class="joms-list clearfix"></ul> <div class=joms-postbox-photo-form></div> </div>'},window.joms.jst["html/postbox/photo"]=function(t){var e,i="";_.escape;return i+='<div class="joms-postbox-photo-wrapper" style="position:relative;"> <div class="joms-postbox--droparea" id="joms-postbox-photo--droparea">'+t.language.photo.drop_to_upload+'</div> <div id=joms-postbox-photo-upload style="position:absolute;top:0;left:0;width:1px;height:1px;overflow:hidden"> <button id=joms-postbox-photo-upload-btn>Upload</button> </div> <div class=joms-postbox-inner-panel style="position:relative"> '+(t.allowgif?'<div class=joms-postbox-double-panel> <ul class="joms-list clearfix"> <li>':"")+'<div class=joms-postbox-photo-upload> <svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-images"></use></svg> '+(null==(e=t.language.photo[t.allowgif?"upload_button_2":"upload_button"])?"":e)+" </div> "+(t.allowgif?'</li> <li> <div class=joms-postbox-gif-upload> <svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-images"></use></svg> '+(null==(e=t.language.photo.gif_upload_button)?"":e)+" </div> </li> </ul> </div>":"")+' </div> <div class=joms-postbox-photo> <div class=joms-postbox-preview></div> <div class=joms-postbox-inputbox></div> <nav class="joms-postbox-tab selected"> <ul class="joms-list inline"> <li data-tab=upload data-bypass=1><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-images"></use></svg> <span class=visible-desktop>'+(null==(e=t.language.photo.upload_button_more)?"":e)+'</span></li> <li data-tab=mood><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-happy"></use></svg> <span class=visible-desktop>'+(null==(e=t.language.status.mood)?"":e)+"</span></li> </ul> <div class=joms-postbox-action> <button class=joms-postbox-cancel>"+(null==(e=t.language.postbox.cancel_button)?"":e)+"</button> <button class=joms-postbox-save>"+(null==(e=t.language.postbox.post_button)?"":e)+'</button> </div> <div class=joms-postbox-loading style="display:none;"> <img src="'+(null==(e=t.juri.root)?"":e)+'components/com_community/assets/ajax-loader.gif" alt="loader"> </div> </nav> </div> </div>'},window.joms.jst["html/postbox/video-item"]=function(t){var e="";_.escape;return e+='<li class=joms-postbox-photo-item> <img width=128 height=128 src="'+(null==(t=t.src)?"":t)+'"> <div class=joms-postbox-photo-action> <span class=joms-postbox-photo-setting><i class=joms-icon-cog></i></span> <span class=joms-postbox-photo-remove><i class=joms-icon-remove></i></span> </div> </li>'},window.joms.jst["html/postbox/video"]=function(t){var e,i="";_.escape,Array.prototype.join;return i+='<div> <div id=joms-postbox-video-upload style="position:absolute;top:0;left:0;width:1px;height:1px;overflow:hidden"> <button id=joms-postbox-video-upload-btn>Upload</button> </div> ',t&&t.enable_upload&&(i+=' <div class="joms-postbox-inner-panel joms-initial-panel"> <div class=joms-postbox-double-panel> <ul class="joms-list clearfix"> <li class=joms-postbox-video-url data-action=share><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-link"></use></svg> '+(null==(e=t.language.video.share_button)?"":e)+'</li> <li class=joms-postbox-video-upload data-action=upload><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-box-add"></use></svg> '+(null==(e=t.language.video.upload_button)?"":e)+" ",t&&0<t.video_maxsize&&(i+=" <span>"+(null==(e=t.language.video.upload_maxsize)?"":e)+" "+(null==(e=t.video_maxsize)?"":e)+"mb</span> "),i+=" </li> </ul> </div> </div> "),i+=' <div class=joms-postbox-video> <div class=joms-postbox-video-state-url style="display:none"> <div class=joms-postbox-inner-panel> <div class=joms-postbox-url></div> <div class=joms-postbox-fetched></div> </div> </div> ',t&&t.enable_upload&&(i+=' <div class=joms-postbox-video-state-upload style="display:none"> <div class=joms-postbox-inner-panel> <div class=joms-postbox-url></div> <div style="padding-top: 3px;"> <div class=joms-postbox-photo-progressbar style="position:relative;top:auto;bottom:auto;left:auto;right:auto;background-color:#eee;"> <div class=joms-postbox-photo-progress style="width:0"></div> </div> </div> <div style="padding-top: 10px;"> <div class="joms-fetched-category joms-select" style="padding:3px 0"></div> </div> </div> <div class=joms-postbox-inner-panel> <div class=inputbox> <input class=input placeholder="'+(null==(e=t.language.video.upload_title)?"":e)+'" /> </div> </div> </div> '),i+=' <div class=joms-postbox-inputbox></div> <nav class="joms-postbox-tab selected"> <ul class="joms-list inline"> <li data-tab=mood><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-happy"></use></svg> <span class=visible-desktop>'+(null==(e=t.language.status.mood)?"":e)+'</span></li> <li data-tab=location><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-location"></use></svg> <span class=visible-desktop>'+(null==(e=t.language.video.location)?"":e)+'</span></li> <li data-tab=privacy><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-earth"></use></svg> <span class=visible-desktop></span></li> </ul> <div class=joms-postbox-action> <button class=joms-postbox-cancel>'+(null==(e=t.language.postbox.cancel_button)?"":e)+"</button> <button class=joms-postbox-save>"+(null==(e=t.language.postbox.post_button)?"":e)+'</button> </div> <div class=joms-postbox-loading style="display:none;"> <img src="'+(null==(e=t.juri.root)?"":e)+'components/com_community/assets/ajax-loader.gif" alt="loader"> <div> </nav> </div> </div>'},window.joms.jst["html/widget/select-album"]=function(t){var e,i="";_.escape,Array.prototype.join;if(i+="<span>"+(null==(e=t.placeholder||"")?"":e)+'</span> <ul class=joms-list style="display:none;"> ',t.options&&t.options.length)for(var s=0;s<t.options.length;s++)i+=' <li data-value="'+(null==(e=t.options[s][0])?"":e)+'"> <p style="margin:0">'+(null==(e=t.options[s]&&t.options[s][1]||"-")?"":e)+'</p> <small><i class="joms-icon-'+(null==(e=t.options[s]&&t.options[s][3]?""+t.options[s][3]:"globe")?"":e)+'"></i> '+(null==(e=t.options[s]&&t.options[s][2]?""+t.options[s][2]:"-")?"":e)+"</small> </li> ";return i+=' </ul><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-arrow-down"></use></svg>'},window.joms.jst["html/widget/select-form"]=function(t){var e,i="";_.escape,Array.prototype.join;if(i+="<span>"+(null==(e=t.placeholder||"")?"":e)+'</span> <ul class=joms-list style="display:none;"> ',t.options&&t.options.length)for(var s=0;s<t.options.length;s++)i+=' <li data-value="'+(null==(e=t.options[s][0])?"":e)+'">'+(null==(e=t.options[s][1])?"":e)+"</li> ";return i+=" </ul> <div>abc</div>"},window.joms.jst["html/widget/select"]=function(t){var e,i="";_.escape,Array.prototype.join;if(i+="<span>"+(null==(e=t.placeholder||"")?"":e)+'</span> <ul class=joms-list style="display:none;"> ',t.options&&t.options.length)for(var s=0;s<t.options.length;s++)i+=' <li data-value="'+(null==(e=t.options[s][0])?"":e)+'">'+(null==(e=t.options[s][1])?"":e)+"</li> ";return i+=' </ul><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="'+(window.joms_current_url||"")+'#joms-icon-arrow-down"></use></svg>'}}),define("sandbox",[],function(){var i=window.joms.jQuery,t=window.joms._,e=window.joms.Backbone;function s(t,e){return i(t,e)}e.$=i,t.pick(t,["each","map","filter","union","intersection","without","bind","debounce","defer","keys","extend","pick","omit","isArray","isNumber","isString","isUndefined","uniqueId"]),t.extend(s,e.Events,t,{mvc:{Model:e.Model,Models:e.Collection,View:e.View},ajax:i.ajax,param:i.param,noop:function(){}}),s.__extend=s.extend,s._$extend=i.extend,s.extend=function(){return s[!0===arguments[0]?"_$extend":"__extend"].apply(null,arguments)};t=(s.ua=navigator.userAgent).toLowerCase();return s.mobile=!!t.match(/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i),s.webkit=!!t.match(/webkit/i),s.ie=!!t.match(/msie/i),s.ieVersion=s.ie&&+t.match(/msie (\d+)\./i)[1],s.xpriment=!s.ie&&1,s(document.body).on("click",function(t){s.trigger("click",s(t.target))}),s}),define("views/base",["sandbox"],function(i){return i.mvc.View.extend({assign:function(t,e){i.isArray(t)||(t=[[t,e]]),i.each(t,function(t){t[1].setElement(t[0]).render()})},show:function(){this.isHidden()&&(this.$el.show(),this.trigger("show"))},hide:function(){this.isHidden()||(this.$el.hide(),this.trigger("hide"))},toggle:function(){this.isHidden()?this.show():this.hide()},isHidden:function(){return"none"===this.el.style.display}})}),define("app",[],function(){var t=window.joms_script_url||"";return{staticUrl:t=t.replace(/js\/$/,""),legacyUrl:t+"../../"}}),define("utils/ajax",["sandbox"],function(n){var e={type:"post",data:{},dataType:"json",error:n.noop,success:n.noop,complete:n.noop};return function(t){return(t=n.extend({},e,t||{})).url=window.jax_live_site,t.data=function(t,e){var i={option:"community"};i.view=window.joms_page||void 0,i.task="azrul_ajax",i.func=t,i.no_html=1,i[window.jax_token_var]=1,n.isArray(e)||(e=[]);for(var s,o=0;o<e.length;o++)s=e[o],n.isString(s)&&(s=s.replace(/"/g,"&quot;")),n.isArray(s)||(s=["_d_",s]),i["arg"+(o+2)]=JSON.stringify(s);return i}(t.fn,t.data),n.ajax(t)}}),define("utils/constants",["sandbox"],function(i){var o={};return{get:function(t){if("string"==typeof t&&t.length){joms&&joms.constants&&(i.extend(!0,o,joms&&joms.constants),delete joms.constants);var e=o;for(t=t.split(".");t.length;)e=e[t.shift()];return e}},set:function(t,e){var i,s;if("string"==typeof t&&t.length){for(i=o,s=t.split("."),t.length;s.length-1;)i[t=s.shift()]||(i[t]={}),i=i[t];i[t]=e}}}}),define("views/postbox/default",["sandbox","app","views/base","utils/ajax","utils/constants"],function(o,t,e,s,i){return e.extend({subviews:{},template:function(){throw new Error("Method not implemented.")},events:{"click li[data-tab]":"onToggleDropdown","click button.joms-postbox-cancel":"onCancel","click button.joms-postbox-save":"onPost","click .joms-postbox-input":"inputFocus"},initialize:function(t){t&&t.single&&(this.single=!0),this.subflags={},this.reset()},render:function(){var t=this.getTemplate();return this.$el.replaceWith(t),this.setElement(t),this.$tabs=this.$(".joms-postbox-tab"),this.$action=this.$(".joms-postbox-action").hide(),this.$loading=this.$(".joms-postbox-loading").hide(),this.$save=this.$(".joms-postbox-save").hide(),this},show:function(){this.showInitialState(),e.prototype.show.apply(this)},showInitialState:function(){this.reset(),this.$tabs.hide(),this.$action.hide(),this.$save.hide(),this.trigger("show:initial")},showMainState:function(){this.$tabs.show(),this.$action.show(),this.trigger("show:main")},reset:function(){for(var t in this.data={},this.data.text="",this.data.attachment={},this.subflags)this.subviews[t].reset(),this.subviews[t].hide()},value:function(t){var e=o.extend({},this.getStaticAttachment(),this.data.attachment);return[this.data.text,t?e:JSON.stringify(e)]},inputFocus:function(t){this.$(t.currentTarget).find(".joms-textarea__wrapper").find(".input.joms-textarea").focus(),this.inputbox.trigger("focus")},validate:o.noop,onToggleDropdown:function(t){t=o(t.currentTarget);if(!t.data("bypass")){var e=t.data("tab");if(this.subviews[e])if(this.subflags[e]||this.initSubview(e),this.subviews[e].isHidden()){for(var i in this.subflags)i!==e&&this.subviews[i].hide();this.subviews[e].show()}else this.subviews[e].hide()}},onCancel:function(){t.postbox&&t.postbox.value&&(t.postbox.value=!1),this.saving||this.showInitialState()},onPost:function(){var t,e,i;this.saving||((e=this.validate())?window.alert(e):(this.saving=!0,this.$loading.show(),e=(t=this).value(),window.joms_filter_params&&e.push(JSON.stringify(window.joms_filter_params)),window.joms_postbox_posting=!0,s({fn:"system,ajaxStreamAdd",data:e,success:o.bind((i=this).onPostSuccess,this),complete:function(){window.joms_postbox_posting=!1,t.$loading.hide(),t.saving=!1,t.showInitialState(),+window.joms_infinitescroll&&o(".joms-stream__loadmore").find("a").hide(),i.initVideoPlayers()}})))},initVideoPlayers:function(){var t=".joms-js--initialized",e=".joms-js--video",t=o(".joms-comment__body,.joms-js--inbox").find(e).not(t).addClass(t.substr(1));t.length&&(joms.loadCSS(joms.ASSETS_URL+"vendors/mediaelement/mediaelementplayer.min.css"),t.on("click.joms-video",e+"-play",function(){var t=o(this).closest(e);joms.util.video.play(t,t.data())}))},onPostSuccess:function(t){t=this.parseResponse(t);t&&(o(".joms-stream__wrapper").first().html(t),o.trigger("postbox:status"),window.joms&&joms.view&&joms.view.streams&&(joms.view.streams.start(),joms.view.misc.fixSVG()))},initSubview:function(t,e){var i=t.replace(/^./,function(t){return t.toUpperCase()});this.subflags[t]||(this.subviews[t]=new this.subviews[t](e),this.assign(this.getSubviewElement(),this.subviews[t]),this.listenTo(this.subviews[t],"init",this["on"+i+"Init"]),this.listenTo(this.subviews[t],"show",this["on"+i+"Show"]),this.listenTo(this.subviews[t],"hide",this["on"+i+"Hide"]),this.listenTo(this.subviews[t],"select",this["on"+i+"Select"]),this.listenTo(this.subviews[t],"remove",this["on"+i+"Remove"]),this.subflags[t]=!0)},getSubviewElement:function(){return o("<div>").hide().appendTo(this.$el)},parseResponse:function(t){var e,i;if(t.html)return t.html;if(t&&t.length)for(var s=0;s<t.length;s++)"__throwError"!==t[s][1]&&"al"!==t[s][0]||(i=t[s][3],window.alert(o.isArray(i)?i.join(". "):i)),e||"activity-stream-container"!==t[s][1]||(e=t[s][3]);return e},getTemplate:function(){var t=this.template({juri:i.get("juri")});return o(t).hide()},getStaticAttachment:function(){return this.staticAttachment||(this.staticAttachment=o.extend({},i.get("postbox.attachment")||{},{type:""})),this.staticAttachment}})}),define("utils/image",[],function(){function i(t,e){this.images=[],this.loaded=[],this.processed=0,this.callback=e,t&&t.length||(t=[]);for(var i=/^(http:|https:)?\/\/([a-z0-9-]+\.)+[a-z]{2,18}\/.*$/i,s=0;s<t.length;s++)t[s].match(i)&&this.images.push(t[s])}return i.prototype.load=function(){if(this.images&&this.images.length)for(var t,e=0;e<this.images.length;e++)(t=new Image).onload=this.onload,t.onerror=this.onerror,t.onabort=this.onabort,t.preloader=this,t.src=t._src=this.images[e];else this.callback([])},i.prototype.onload=function(){this.preloader.loaded.push(this._src),this.preloader.oncomplete()},i.prototype.onerror=function(){this.preloader.oncomplete()},i.prototype.onabort=function(){this.preloader.oncomplete()},i.prototype.oncomplete=function(){var t,e=[];if(this.processed++,this.processed>=this.images.length){for(t=0;t<this.images.length;t++)-1<this.loaded.indexOf(this.images[t])&&e.push(this.images[t]);this.callback(e)}},{preload:function(t,e){new i(t,e).load()}}}),define("utils/language",["sandbox"],function(i){var s={};return{get:function(t){if("string"==typeof t&&t.length){joms&&joms.language&&(i.extend(!0,s,joms&&joms.language),delete joms.language);var e=s;for(t=t.split(".");t.length;)e=e[t.shift()];return e}}}}),define("views/postbox/fetcher",["sandbox","views/base","utils/ajax","utils/image","utils/language"],function(s,t,i,o,n){return t.extend({template:joms.jst["html/postbox/fetcher"],events:{"click .joms-fetched-close":"onClose","click .joms-fetched-field span":"onFocus","keyup .joms-fetched-field input":"onKeyup","keyup .joms-fetched-field textarea":"onKeyup","blur .joms-fetched-field input":"onBlur","blur .joms-fetched-field textarea":"onBlur","click .joms-fetched-previmg":"prevImage","click .joms-fetched-nextimg":"nextImage"},initialize:function(){var t=n.get("fetch")||{};this.titlePlaceholder=t.title_hint||"",this.descPlaceholder=t.description_hint||""},fetch:function(t){var e=t.match(/^(|.*\s)((https?:\/\/|www\.)([a-z0-9-]+\.)+[a-z]{2,18}(:\d+)?(\/.*)?)(\s.*|)$/i);!this.fetching&&e&&(t=e[2],this.fetching=!0,this.fetched=!1,delete this.url,this.trigger("fetch:start"),i({fn:"system,ajaxGetFetchUrl",data:[t],success:s.bind(this.render,this),complete:s.noop}))},render:function(t){t=t||{},this.fetched=!0,this.url=t.url||"";var e={title:t.title||"",titlePlaceholder:this.titlePlaceholder,description:t.description||"",descPlaceholder:this.descPlaceholder,image:(t.image||[]).concat(t["og:image"]||[]),lang:{prev:(n.get("prev")||"").toLowerCase(),next:(n.get("next")||"").toLowerCase(),cancel:(n.get("cancel")||"").toLowerCase()}};this.url.match(/^https?:\/\//i)||(this.url="http://"+this.url);for(var i=0;i<e.image.length;i++)e.image[i].match(/^(http:|https:)?\/\//i)||(e.image[i]="//"+e.image[i]);o.preload(e.image,s.bind(function(t){e.image=t,this.$el.html(this.template(e)),this.$images=this.$(".joms-fetched-images").find("img"),this.$title=this.$(".joms-fetched-title").find("input"),this.$description=this.$(".joms-fetched-description").find("textarea"),this.fetching=!1,this.trigger("fetch:done")},this))},change:function(t){var t=s(t),e=t.prev("span"),i=(i=t.val().replace(/^\s+|\s+$/g,""))||(t.parent().hasClass("joms-fetched-title")?this.titlePlaceholder:this.descPlaceholder);t.hide(),e.text(i).show()},remove:function(){delete this.url,t.prototype.remove.apply(this),this.trigger("remove")},prevImage:function(){var t=this.$images.filter(":visible"),e=t.prev();e.length&&(t.hide(),e.show())},nextImage:function(){var t=this.$images.filter(":visible"),e=t.next();e.length&&(t.hide(),e.show())},value:function(){if(!this.fetching&&this.url)return[this.url,this.$images&&this.$images.filter(":visible").attr("src"),this.$title&&this.escapeValue(this.$title.val()),this.$description&&this.escapeValue(this.$description.val())]},onClose:function(){this.remove()},onFocus:function(t){var t=s(t.currentTarget),e=t.next("input,textarea");t.hide(),e.show(),setTimeout(function(){e[0].focus()},300)},onKeyup:function(t){13===t.keyCode&&this.change(t.currentTarget)},onBlur:function(t){this.change(t.currentTarget)},parseResponse:function(t){if(t=t&&t[2]&&t[2][3]&&t[2][3][0]||!1){var e;try{e=JSON.parse(t)}catch(t){}return e}},escapeValue:function(t){return"string"!=typeof t?t:t.replace(/\\/g,"&#92;").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/&quot;/g,'"')}})}),define("views/inputbox/base",["sandbox","views/base","utils/constants"],function(o,t,n){return t.extend({events:{"focus .input.joms-textarea":"onFocus","focus .input":"onFocus","keydown .input.joms-textarea":"onKeydownProxy","keydown .input":"onKeydownProxy","input .input.joms-textarea":"onInput","input .input":"onInput","paste .input.joms-textarea":"onPaste","blur .input.joms-textarea":"onBlur","blur .input":"onBlur"},initialize:function(t){o.mobile||(this.onInput=this.onKeydown,this.onKeydownProxy=this.onKeydown,this.updateCharCounterProxy=this.updateCharCounter),t=t||{},this.flags={},this.flags.attachment=t.attachment,this.flags.charcount=t.charcount,this.listenTo(o,"postbox:tab:change",this.reset)},render:function(){this.$mirror=this.$("span.input"),this.$textarea=this.$(".input.joms-textarea"),this.$textarea.length||(this.$textarea=this.$("textarea.input")),this.placeholder=this.$textarea.attr("placeholder"),this.flags.attachment&&(this.$attachment=o("<span class=attachment>").insertAfter(this.$mirror)),this.reset()},set:function(t){this.$textarea.val(t),this.flags.attachment&&this.updateAttachment(),this.flags.charcount&&this.updateCharCounterProxy(),this.onKeydownProxy()},reset:function(){this.$textarea.val(""),this.flags.attachment&&this.updateAttachment(),this.flags.charcount&&this.updateCharCounterProxy(),this.onKeydownProxy()},value:function(){var t=this.$textarea[0];return(t.joms_hidden?t.joms_hidden.val():t.value).replace(/\t/g,"\\t").replace(/%/g,"%25")},onFocus:function(){this.trigger("focus")},onKeydown:function(t){var e;void 0===this.maxchar&&(this.maxchar=+n.get("conf.statusmaxchar")||0),this.value().length>=this.maxchar&&this.isPrintable(t)?t.preventDefault():(e=this,o.defer(function(){e.updateInput(t)}))},onKeydownProxy:o.debounce(function(t){this.onKeydown(t)},10),onInput:function(){this.onKeydownProxy()},onPaste:function(){var e=this;this.onKeydownProxy(function(){var t=e.$textarea[0],t="DIV"==t.tagName?e.$textarea.text():t.value;e.trigger("paste",t,13)})},onBlur:function(){var t=this.$textarea[0],t="DIV"==t.tagName?this.$textarea.text():t.value;this.trigger("blur",t,13)},updateInput:function(t){var e=t&&t.keyCode||!1,i=this.$textarea[0],s="DIV"==i.tagName?this.value():i.value,i=(""===s.replace(/^\s+|\s+$/g,"")&&(i.value=s=""),void 0===this.maxchar&&(this.maxchar=+n.get("conf.statusmaxchar")||0),s.length>this.maxchar&&(s=s.substr(0,this.maxchar),"DIV"==i.tagName?this.$textarea.text(s):i.value=s),"DIV"===i.tagName?this.$textarea.html():this.normalize(s));this.$mirror.html(i+"."),this.$colorInner&&(this.setColorStatusValue(s),""!=s?this.$colorPlaceholder.hide():this.$colorPlaceholder.show(),this.reactColorList(),!1!==this.colorfulSelected&&o(this.colorfulSelected).trigger("click")),this.$textarea.css("height",this.$mirror.height()),this.flags.charcount&&this.updateCharCounterProxy(),this.trigger("keydown",s,e),"function"==typeof t&&t()},updateAttachment:o.noop,updateCharCounterProxy:o.debounce(function(){this.updateCharCounter()},300),updateCharCounter:function(){if(void 0===this.maxchar&&(this.maxchar=+n.get("conf.statusmaxchar")||0),this.$charcount||(this.$charcount=this.$(".charcount")),!this.maxchar||this.maxchar<=0)this.$charcount.hide();else{let t=0;t=("DIV"==this.$textarea[0].tagName?this.$textarea.text():this.$textarea.val()).length,this.$charcount.html(this.maxchar-t).show()}},isPrintable:function(t){if(!t)return!1;if((t.crtlKey||t.metaKey)&&!t.altKey&&!t.shiftKey)return!1;t=t&&t.keyCode;return 13===t||32===t||47<t&&t<58||64<t&&t<91||95<t&&t<112||185<t&&t<193||218<t&&t<223},normalize:function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>")},resetTextntags:function(t,e){try{this.$textarea.hasClass("joms-postbox-video-description")||((t=o(t)).removeData("joms-tagging"),t.val(e).jomsTagging(),t.data("joms-tagging").initialize())}catch(t){}}})}),define("views/inputbox/status",["sandbox","views/inputbox/base","utils/constants","utils/language"],function(a,n,l,s){return n.extend({template:_.template('    <div class="joms-postbox__status-composer" style="position:relative">        <div class="joms-postbox-input joms-inputbox" style="<%= enablebackground ? \'padding-bottom: 60px\' : \'\' %>">            <div class=inputbox>                <div style="position:relative">                    <div style="position:relative"><span class=input></span></div>                    <div class=joms-textarea__wrapper>                        <textarea class="input input-status joms-textarea" placeholder="<%= placeholder %>" style="min-height:1.4em"></textarea>                    </div>                </div>            </div>        </div>        <div class="joms-icon joms-icon--emoticon" style="top:20px; right: 5px;">            <div style="position:relative"><svg viewBox="0 0 16 16" onclick="joms.util.emoticon.showBoard(this);">                <use xlink:href="<%= window.joms_current_url %>#joms-icon-smiley"></use>                </svg></div>        </div>        <div class="charcount joms-postbox-charcount"></div>        <% if(enablebackground) { %>        <div class="colorful-status__container" style="display: none;">        <div class="charcount joms-postbox-charcount"></div>        <div class="joms-icon joms-icon--emoticon" style="top:20px; right: 5px;">            <div style="position:relative;z-index:99999"><svg viewBox="0 0 16 16" onclick="joms.util.emoticon.showBoard(this);">                <use xlink:href="<%= window.joms_current_url %>#joms-icon-smiley"></use>                </svg></div>        </div>            <div class="colorful-status__placeholder" unselectable="on"><%= placeholder %></div>            <div class="colorful-status__inner" contenteditable="true"><div><br></div></div>        </div>        <div class="colorful-status__color">            <span class="joms-direction joms-left"><i class="fa fa-chevron-left" aria-hidden="true"></i></span>            <ul class="colorful-status__color-list"></ul>            <span class="joms-direction joms-right"><i class="fa fa-chevron-right" aria-hidden="true"></i></span>        </div>        <% } %>    </div>'),getTemplate:function(){var t=s.get("status.status_hint")||"",e=l.get("conf").enablebackground,t=this.template({placeholder:t,enablebackground:e});return a(t)},events:function(){return _.extend({},n.prototype.events,{"keydown .colorful-status__inner":"onColorStatusKeydown","keyup .colorful-status__inner":"onColorStatusKeyup","input .colorful-status__inner div":"onColorStatusInput","input .colorful-status__inner":"onColorStatusInput","paste .colorful-status__inner":"onColorStatusPaste","focus .colorful-status__inner":"onColorStatusFocus","click .colorful-status__inner div":"onColorContentClick","click .colorful-status__inner":"onColorContentClick","click .colorful-status__color-selector":"onColorSelect","click .joms-left":"colorSlideToLeft","click .joms-right":"colorSlideToRight","click .colorful-status__container":"focusColorContent"})},smileyCallback:function(t){var e=this.$inputbox.find("textarea"),i=this.$inputbox.find("input.joms-textarea__hidden"),s=this.getSmileyInsertPosition();(value=e.val().slice(0,s)+t+e.val().slice(s)).length>this.maxchar||(i.val(value),e.val(value),0==this.colorful?(e.prop("selectionStart",s+t.length),e.prop("selectionEnd",s+t.length),e.focus(),e.trigger("keydown")):void 0!==this.$colorContainer&&(this.setColorStatusValue(value),i=s+t.length,this.$colorInner.attr("cachedPostion",i),this.cachedPostion=i,e=this.getPos(i),this.setCaretPostion(e.node,e.position)),this.flags.charcount&&this.updateCharCounterProxy(),this.trigger("keydown",value))},getSmileyInsertPosition:function(){var t=this.$inputbox.find("textarea").prop("selectionStart");return 0==this.colorful?t:this.cachedPostion},getCaretPosition:function(){var t,e,i=this.$colorInner[0],s=0,o=i.ownerDocument||i.document,n=o.defaultView||o.parentWindow,o=(void 0!==n.getSelection?0<(t=n.getSelection()).rangeCount&&((e=(n=n.getSelection().getRangeAt(0)).cloneRange()).selectNodeContents(i),e.setEnd(n.endContainer,n.endOffset),s=e.toString().length):(t=o.selection)&&"Control"!=t.type&&(n=t.createRange(),(e=o.body.createTextRange()).moveToElementText(i),e.setEndPoint("EndToEnd",n),s=e.text.length),this.$colorInner.children().index(a(t.focusNode).parent()));return s=(s+=o=-1==o?this.$colorInner.children().index(a(t.focusNode)):o)<0?0:s},setColorStatusValue:function(t){var t=t.split(/\r?\n/),i="";a.each(t,function(t,e){i+=""!=t?"<div>"+t+"</div>":"<div><br></div>"}),""==i?(i="<div><br></div>",this.$colorPlaceholder.show()):this.$colorPlaceholder.hide(),this.$colorInner.html(i)},initialize:function(t){var e,i,s,o;if(n.prototype.initialize.apply(this,arguments),this.moods=l.get("moods"),e={},this.moods&&this.moods.length)for(o=0;o<this.moods.length;o++)i=[s=this.moods[o].id,this.moods[o].description],this.moods[o].custom&&(i[2]=this.moods[o].image),e[s]=i;this.moods=e,this.colorful=!1,this.blankDiv="<div><br></div>",this.isAndroid=-1<navigator.userAgent.toLowerCase().indexOf("android"),this.newText="",this.oldOffset=0,this.newOffset=0,this.status=t.status,this.status_text={hidden:"",textarea:"",div:"",set:function(t){}}},render:function(){var t,e=this.getTemplate();this.$el.replaceWith(e),this.setElement(e),conf=l.get("conf"),n.prototype.render.apply(this,arguments),this.$el.find(".joms-icon--emoticon").data("editor",this),this.$inputbox=this.$el.find(".joms-postbox-input"),this.status&&conf.enablebackground&&(this.$cachedElement=null,this.cachedPostion=0,this.$colorContainer=this.$el.find(".colorful-status__container"),this.$colorInner=this.$colorContainer.find(".colorful-status__inner"),this.$colorPlaceholder=this.$colorContainer.find(".colorful-status__placeholder"),this.$color=this.$el.find(".colorful-status__color"),this.$colorList=this.$color.find(".colorful-status__color-list"),this.$colorContainer.find(".joms-icon--emoticon").data("editor",this),this.$colorList.html(this.renderColorList()),a.mobile&&this.$colorList.css("overflow-x","auto"),t=this,setTimeout(function(){t.initColorSlide()},100),a(window).on("resize",function(){t.initColorSlide()}),joms.ie&&setTimeout(function(){t.onInputPolyfill()},300))},renderColorList:function(){var t=l.get("backgrounds").map(function(t){return'<li class="colorful-status__color-selector"                    data-bgid="'+t.id+'"                    data-text-color="#'+t.textcolor+'"                    data-placeholder-color="#'+t.placeholdercolor+'"                    data-image="'+t.image+'"                    style="background-image: url(\''+t.thumbnail+'\')">                    <img style="display:none" src="'+t.image+'" />                </li>'});return t.unshift('<li class="colorful-status__color-selector active" style="background-image: url(\''+joms.ASSETS_URL+"photos/none.png')\"></li>"),t.join("")},set:function(t){this.resetTextntags(this.$textarea,t),this.flags.attachment&&this.updateAttachment(!1,!1),this.flags.charcount&&this.updateCharCounterProxy(),this.onKeydownProxy()},reset:function(){this.colorfulSelected=!1,this.colorful=!1,this.$inputbox&&this.$inputbox.show(),this.resetColorfulStatus(),this.$cachedElement=null,this.cachedPostion=0,this.$colorList&&this.$colorList.html(this.renderColorList()),this.resetTextntags(this.$textarea,""),this.flags.attachment&&this.updateAttachment(!1,!1),this.flags.charcount&&this.updateCharCounterProxy(),this.onKeydownProxy()},resetColorfulStatus:function(){this.$colorContainer&&this.$colorContainer.hide(),this.$colorInner&&this.$colorInner.html(this.blankDiv),this.$colorPlaceholder&&this.$colorPlaceholder.show()},reactColorList:function(){4<this.$colorInner.children().length||150<=this.$textarea[0].value.length?this.$color.hide():this.$color.show()},value:function(){var t,i="";return this.colorful?(this.$colorInner.children().each(function(t,e){e=a(e).text();i?i+="\n"+e:i=e}),0==this.$colorInner.children().length?this.$colorInner.html():i):(t=this.$textarea[0],(i=t.joms_hidden?t.joms_hidden.val():t.value).replace(/\t/g,"\\t").replace(/%/g,"%25"))},updateInput:function(){n.prototype.updateInput.apply(this,arguments)},updateAttachment:function(t,e){var i=[];this.mood=t||!1===t?t:this.mood,this.location=e||!1===e?e:this.location,this.location&&this.location.name&&i.push("<b>"+s.get("at")+" "+this.location.name+"</b>"),this.mood&&this.moods[this.mood]&&(void 0!==this.moods[this.mood][2]?i.push('<img class="joms-emoticon" src="'+this.moods[this.mood][2]+'"> <b>'+this.moods[this.mood][1]+"</b>"):i.push('<i class="joms-emoticon joms-emo-'+this.mood+'"></i> <b>'+this.moods[this.mood][1]+"</b>")),i.length?(this.$attachment.html(" &nbsp;&mdash; "+i.join(" "+s.get("and")+" ")+"."),this.$textarea.removeAttr("placeholder")):(this.$attachment.html(""),this.$textarea.attr("placeholder",this.placeholder))},onInputPolyfill:function(){var s=this,t=s.$colorInner[0];new MutationObserver(function(t){t.forEach(function(t){var e=s.$colorInner.text(),i=s.$colorInner.children().length;e||1<i?s.$colorPlaceholder.hide():s.$colorPlaceholder.show()})}).observe(t,{childList:!0,characterData:!0,subtree:!0})},focusColorContent:function(t){a(t.srcElement).hasClass("colorful-status__container")&&(t.preventDefault(),(this.$cachedElement||this.$colorInner)[0],t=this.getPos(this.cachedPostion),this.setCaretPostion(t.node,t.position))},initColorSlide:function(){this.$colorList.width()<this.$colorList[0].scrollWidth?this.$color.find(".joms-direction").show():this.$color.find(".joms-direction").hide()},colorSlideToLeft:function(){var t=this.$colorList.scrollLeft(),e=a.mobile?100:200;this.$colorList.stop().animate({scrollLeft:t-e})},colorSlideToRight:function(){var t=this.$colorList.scrollLeft(),e=a.mobile?100:200;this.$colorList.stop().animate({scrollLeft:t+e})},isComposing:function(t){return 32===t||47<t&&t<91||95<t&&t<112||183<t&&t<224},setCaretPostion:function(t,e){0==this.$textarea[0].value.length&&(this.$colorInner[0].childNodes[0].innerHTML=" ",t=this.$colorInner[0].childNodes[0]);var i=document.createRange(),s=window.getSelection();i.setStart(t,e||0),i.collapse(!0),s.removeAllRanges(),s.addRange(i),this.$colorInner[0].focus()},cacheCaret:function(){var t=window.getSelection();this.$cachedElement=a(t.focusNode).parent(),this.cachedPostion=this.getCaretPosition(),this.$cachedElement.attr("cachedPostion",this.cachedPostion),this.$colorInner.attr("cachedPostion",this.cachedPostion)},onColorContentClick:function(){this.cacheCaret()},onColorStatusKeydown:function(t){var e=-1<[8,46].indexOf(t.keyCode),i=13===t.keyCode,s=window.getSelection();if(this.oldOffset=s.focusOffset,!this.isAndroid&&e)(e=this.$colorInner.html().trim())===this.blankDiv?t.preventDefault():e||(t.preventDefault(),this.$colorInner.html(this.blankDiv),this.setCaretPostion(this.$colorInner[0]));else{var e=this.$colorInner.children().length,o=this.$colorInner.text().length;if(i){if(149<(e=this.$colorInner.children().length)+o||3<e)return this.colorful=!1,this.$inputbox.show(),this.$colorContainer.hide(),this.$textarea.css("height",this.$mirror.height()),this.$textarea[0].focus(),this.$textarea[0].selectionStart=this.cachedPostion,this.$textarea[0].selectionEnd=this.cachedPostion,void this.reactColorList();if(this.cacheCaret(),!this.$(s.focusNode).text())return void t.preventDefault()}this.cacheCaret(),149<=e+o?(this.colorful=!1,this.$inputbox.show(),this.$colorContainer.hide(),this.$textarea.css("height",this.$mirror.height()),this.$textarea[0].focus(),this.$textarea[0].selectionStart=this.cachedPostion,this.$textarea[0].selectionEnd=this.cachedPostion,this.reactColorList()):!this.isAndroid&&this.isComposing(t.keyCode)&&!t.ctrlKey&&149<e+o&&t.preventDefault()}},onColorStatusKeyup:function(t){var e=-1<[8,46].indexOf(t.keyCode),i=this.$colorInner.text().trim();this.trigger("keydown",i?"1":"",t.keyCode),!e&&!this.isAndroid||"<br>"!==(i=this.$colorInner.html().trim())&&i||(t.preventDefault(),this.$colorInner.html(this.blankDiv),this.setCaretPostion(this.$colorInner[0])),this.cacheCaret(),0==this.$colorInner.children().length&&(i=(e=this.$colorInner.html()).length,""==e.trim()&&(e="<br>"),this.$colorInner.html("<div>"+e+"</div>"),t=this.getPos(i),this.setCaretPostion(t.node,t.position))},limitChar:function(){var t=this.value();t.length>this.maxchar&&(t=t.trim().substr(0,this.maxchar),this.setColorStatusValue(t),t=this.getPos(this.maxchar),this.setCaretPostion(t.node,t.position))},onColorStatusInput:function(t){this.isAndroid&&(e=this.$colorInner.text(),this.$colorInner.children().length,i=window.getSelection(),this.newOffset=i.focusOffset,this.newText=e,this.$colorInner.children().length,this.newText.length);var e,i=this.value();this.$colorInner.children().length;this.limitChar(),this.setTextareaValue(i),""!=i?this.$colorPlaceholder.hide():this.$colorPlaceholder.show()},setTextareaValue:function(t){t=t.substr(0,this.maxchar);this.resetTextntags(this.$textarea,t),this.flags.attachment&&this.updateAttachment(!1,!1),this.flags.charcount&&this.updateCharCounterProxy(),this.$mirror.html(this.normalize(t)+".")},onColorStatusPaste:function(t){},onColorSelect:function(t){var e=this.$(t.currentTarget),i=e.attr("data-text-color"),s=e.attr("data-placeholder-color"),o=e.attr("data-image"),n=e.attr("data-bgid");this.colorfulSelected=e,4<this.$colorInner.children().length||150<=this.$textarea[0].value.length?(t.preventDefault(),this.colorful=!1,this.$inputbox.show(),this.$colorContainer.hide(),this.$textarea.css("height",this.$mirror.height()),this.$textarea[0].focus(),this.reactColorList()):(this.reactColorList(),e.hasClass("active")||(this.$(".colorful-status__color-selector").removeClass("active"),e.addClass("active")),t=this.colorful?this.cachedPostion:this.$textarea[0].selectionStart,n?(this.colorful=!0,this.bgid=n,this.$inputbox.hide(),this.$colorContainer.show(),this.$colorContainer.css("background-image","url('"+o+"')"),i&&this.$colorInner.css("color",i),s&&this.$colorPlaceholder.css("color",s)):(this.colorfulSelected=!1,this.colorful=!1,this.$inputbox.show(),this.$colorContainer.hide(),this.$textarea.css("height",this.$mirror.height()),this.$textarea[0].focus(),this.$textarea[0].selectionStart=this.cachedPostion,this.$textarea[0].selectionEnd=this.cachedPostion),this.$colorInner.children().length&&this.colorful&&((this.$cachedElement||this.$colorInner.children())[0],this.$colorInner.attr("cachedPostion",t),this.cachedPostion=t,e=this.getPos(t),this.setCaretPostion(e.node,e.position)),this.reactColorList(),this.trigger("change:type",n))},getPos:function(i){var t=jQuery(this.$colorInner[0]),s=null,o=0,n=0;return jQuery.each(t.children(),function(t,e){if(o+=jQuery(e).text().length,i<=o)return s=e,n=jQuery(e).text().length-(o-i),!1;o++}),{node:s.childNodes[0],position:n}},onColorStatusFocus:function(){this.trigger("focus")}})}),define("views/dropdown/base",["sandbox","views/base"],function(t,e){return e.extend({initialize:function(){this.listenTo(t,"click",this._onDocumentClick)},_onDocumentClick:function(t){t.closest(".joms-postbox").length||this.hide()}})}),define("views/dropdown/mood",["sandbox","views/dropdown/base","utils/constants","utils/language"],function(a,t,l,r){return t.extend({template:joms.jst["html/dropdown/mood"],events:{"click li":"onSelect","click .joms-remove-button":"onRemove"},render:function(){var t,e,i,s,o,n;if(this.moods=l.get("moods"),t=[],e={},this.moods&&this.moods.length)for(n=0;n<this.moods.length;n++)s=[i=this.moods[n].id,this.moods[n].title],this.moods[n].custom&&(s[2]=this.moods[n].image),t.push(s),e[i]=s;return this.moods=e,o=this.template({items:t,language:{status:r.get("status")||{}}}),o=a(o).hide(),this.$el.replaceWith(o),this.setElement(o),this.$btnremove=this.$(".joms-remove-button").hide(),this},select:function(t){this.moods[t]&&(this.$btnremove.show(),this.trigger("select",this.mood=t))},value:function(){return this.mood},reset:function(){this.mood=!1,this.$btnremove.hide(),this.trigger("reset")},onSelect:function(t){t=a(t.currentTarget).attr("data-mood");this.select(t),this.hide()},onRemove:function(){this.mood=!1,this.$btnremove.hide(),this.trigger("remove")}})}),define("views/dropdown/location",["sandbox","views/dropdown/base","utils/language","utils/constants"],function(l,t,i,s){var e=i.get("geolocation")||{};return t.extend({template:{div:joms.jst["html/dropdown/location"],list:joms.jst["html/dropdown/location-list"]},placeholders:{loading:e.loading||"",loaded:e.loaded||"",error:e.error||""},initialize:function(){t.prototype.initialize.apply(this),this.location=!1,this.locations={},this.nearbyLocations=!1,this.listenTo(l,"postbox:tab:change",this.onRemove)},events:{"keyup input.joms-postbox-keyword":"onKeyup","click li":"onSelect","click button.joms-add-location":"onAdd","click button.joms-remove-location":"onRemove"},render:function(){s.get("settings");var t=s.get("conf")||{},e=(this.map_type=t.maps_api,this.$el.html(this.getTemplate()),this.$keyword=this.$(".joms-postbox-keyword"),this.$list=this.$(".joms-postbox-locations"),this.$map=this.$(".joms-postbox-map"),this.$btnadd=this.$(".joms-add-location").hide(),this.$btnremove=this.$(".joms-remove-location").hide(),this.$keyword.attr("placeholder",this.placeholders.loading),this);return this.getService(function(){e.setInitialLocation=!0,e.searchLocation()}),this},show:function(){this.$el.show(),this.trigger("show")},hide:function(){this.$el.hide(),this.trigger("hide")},toggle:function(){"none"===this.el.style.display?this.show():this.hide()},filter:function(t){},draw:function(t){var e=this.template.list({language:{geolocation:i.get("geolocation")},items:t});this.filtered=t,this.$list.html(e).css({height:"160px",overflowY:"auto"}),this.setInitialLocation&&(this.setInitialLocation=!1,this.select(0))},select:function(t){t=this.filtered[t];t&&(this.location=t,this.$map.show(),this.$keyword.val(t.name),this.map&&this.marker&&this.marker.setMap(this.map),this.showMap(t.latitude,t.longitude),this.$btnadd.show(),this.$btnremove.hide())},value:function(){var t=[];return!!this.location&&(t.push(this.location.name),t.push(this.location.latitude),t.push(this.location.longitude),t)},reset:function(){this.location=!1,this.marker&&this.marker.setMap(null),this.$keyword.val(""),this.$btnadd.hide(),this.$btnremove.hide(),this.trigger("reset")},onKeyup:l.debounce(function(){this.service&&this.searchLocation()},300),onSelect:function(t){t=l(t.currentTarget).attr("data-index");this.select(+t)},onAdd:function(){this.location&&(this.trigger("select",this.location),this.$btnadd.hide(),this.$btnremove.show(),this.hide())},onRemove:function(){this.reset(),this.trigger("remove"),this.hide(),this.filter()},initMap:function(t,e){"openstreetmap"==this.map_type?this.initOpenstreetMap(t,e):this.initGoogleMap(t,e)},initOpenstreetMap:function(t,e){var i=l("<div>").prependTo(this.$map);i.css("height",110),this.map=new L.Map(i[0],{attributionControl:!1}),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{minZoom:14,center:[51.505,-.09],id:"mapbox.streets"}).addTo(this.map),this.marker=L.marker(),this.marker.setMap=function(t){null===t?this.map.removeLayer(this):(this.addTo(t),this.map=t)}},initGoogleMap:function(){var t=l("<div>").prependTo(this.$map),e=(t.css("height",110),{center:new google.maps.LatLng(1,1),zoom:14,mapTypeId:google.maps.MapTypeId.ROADMAD,mapTypeControl:!1,disableDefaultUI:!0,draggable:!1,scaleControl:!1,scrollwheel:!1,navigationControl:!1,streetViewControl:!1,disableDoubleClickZoom:!0});this.map=new google.maps.Map(t[0],e),this.marker=new google.maps.Marker({draggable:!1,map:this.map}),this.marker.setAnimation(null)},showMap:function(t,e){"openstreetmap"==this.map_type?this.showOpenstreetMap(t,e):this.showGoogleMap(t,e)},showGoogleMap:function(t,e){t=new google.maps.LatLng(t,e);this.marker.setPosition(t),this.map.panTo(t)},showOpenstreetMap:function(t,e){t=L.latLng(t,e);this.marker.setLatLng(t),this.map.setView(t,11,{animation:!0})},getService:function(t){var e;"function"!=typeof t&&(t=function(){}),this.service?t.call(this,this.service):(e=this,joms.map.type=this.map_type,joms.map.execute(function(){e.initMap(),"openstreetmap"==e.map_type?e.service=openstreetmap.PlacesService:e.service=new google.maps.places.PlacesService(e.map),t.call(e,e.service)}))},searchLocation:function(){var t=this.$keyword.val().replace(/^\s+|\s+$/g,"");this.$keyword.attr("placeholder",this.placeholders.loading),this.searchToken=(this.searchToken||0)+1,this[t?"searchLocationQuery":"searchLocationNearby"]({query:t,token:this.searchToken,callback:this.searchLocationCallback})},searchLocationQuery:function(n){var a;this.locations[n.query]?n.callback.apply(this,[this.locations[n.query],null,n]):(a=this).service.textSearch({query:n.query},function(t,e){if("OK"!==e)n.callback.apply(a,[null,a.placeholders.error,n]);else if(l.isArray(t)){for(var i,s=0,o=[];s<t.length;s++)i=t[s],o.push({name:i.name,latitude:i.geometry.location.lat(),longitude:i.geometry.location.lng(),vicinity:i.formatted_address});a.locations[n.query]=o,n.callback.apply(a,[a.locations[n.query],null,n])}else n.callback.apply(a,[null,a.placeholders.error,n])})},searchLocationNearby:function(e){var i=this;navigator.geolocation.getCurrentPosition(function(t){i.detectLocationSuccess(t,e)},function(){i.detectLocationFallback(e)},{timeout:1e4})},searchLocationCallback:function(t,e,i){this.searchToken===i.token&&(this.$keyword.attr("placeholder",this.placeholders.loaded),this.draw(t))},detectLocationSuccess:function(t,e){var t=t&&t.coords||{},i=t.latitude,t=t.longitude;i&&t?this.detectLocationNearby(i,t,e):e.callback.apply(this,[null,this.placeholders.error,e])},detectLocationFallback:function(i){var s=!1,o=this;l.ajax({url:"//freegeoip.net/json/",dataType:"jsonp",success:function(t){var e=t.latitude,t=t.longitude;e&&t&&(s=!0,o.detectLocationNearby(e,t,i))},complete:function(){s||i.callback.apply(o,[null,o.placeholders.error,i])}})},detectLocationNearby:function(t,e,n){var a;this.nearbyLocations?n.callback.apply(this,[this.nearbyLocations,null,n]):(t="openstreetmap"==this.map_type?[t,e]:new google.maps.LatLng(t,e),(a=this).service.nearbySearch({location:t,types:["establishment"],rankBy:1},function(t,e){if("OK"!==e)n.callback.apply(a,[null,a.placeholders.error,n]);else if(l.isArray(t)){for(var i,s=0,o=[];s<t.length;s++)i=t[s],o.push({name:i.name,latitude:i.geometry.location.lat(),longitude:i.geometry.location.lng(),vicinity:i.vicinity});a.nearbyLocations=o,n.callback.apply(a,[a.nearbyLocations,null,n])}else n.callback.apply(a,[null,a.placeholders.error,n])}))},getTemplate:function(){return this.template.div({language:{geolocation:i.get("geolocation")||{}}})}})}),define("views/dropdown/privacy",["sandbox","views/dropdown/base","utils/language"],function(s,o,n){return o.extend({template:joms.jst["html/dropdown/privacy"],events:{"click li":"select"},privacies:{public:[10,"earth"],site_members:[20,"users"],friends:[30,"user"],me:[40,"lock"]},privmaps:{public:"10",site_members:"20",friends:"30",me:"40",0:"public",10:"public",20:"site_members",30:"friends",40:"me"},initialize:function(t){o.prototype.initialize.apply(this),this.privkeys=s.keys(this.privacies),t&&t.privacylist&&t.privacylist.length&&(this.privkeys=s.intersection(this.privkeys,t.privacylist));var e,i=n.get("privacy")||{};for(e in this.privacies)this.privacies[e][2]=i[e]||e,this.privacies[e][3]=i[e+"_desc"]||e;this.defaultPrivacy=this.privkeys[0],void 0!==t.defaultPrivacy&&(t.defaultPrivacy=""+t.defaultPrivacy,t.defaultPrivacy.match(/^\d+$/)&&(t.defaultPrivacy=this.privmaps[t.defaultPrivacy]||this.defaultPrivacy),0<=this.privkeys.indexOf(t.defaultPrivacy)&&(this.defaultPrivacy=t.defaultPrivacy))},render:function(){for(var t,e=[],i=0;i<this.privkeys.length;i++)t=this.privkeys[i],e[i]=[t,this.privacies[t][1],this.privacies[t][2],this.privacies[t][3]];return this.$el.html(this.template({items:e})),this.setPrivacy(this.defaultPrivacy),this},select:function(t){t=s(t.currentTarget).attr("data-priv");this.setPrivacy(t),this.hide()},setPrivacy:function(t){var e={};0<=this.privkeys.indexOf(t)&&(this.privacy=this.privacies[t][0],e.icon=this.privacies[t][1],e.label=this.privacies[t][2].toLowerCase(),this.trigger("select",e))},value:function(){return this.privacy},reset:function(){this.setPrivacy(this.defaultPrivacy)}})}),define("views/postbox/status",["sandbox","app","views/postbox/default","views/postbox/fetcher","views/inputbox/status","views/dropdown/mood","views/dropdown/location","views/dropdown/privacy","utils/constants","utils/language"],function(a,t,i,s,o,e,n,l,r,h){return i.extend({subviews:{mood:e,location:n,privacy:l},template:_.template('<div class=joms-postbox-status>                <div class=joms-postbox-fetched></div>                <div class=joms-postbox-inputbox></div>                <nav class="joms-postbox-tab selected">                    <ul class="joms-list inline">                        <li data-tab=mood><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="<%= window.joms_current_url %>#joms-icon-happy"></use></svg></li>                        <li data-tab=location><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="<%= window.joms_current_url %>#joms-icon-location"></use></svg></li>                        <li data-tab=privacy><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="<%= window.joms_current_url %>#joms-icon-earth"></use></svg> </li>                        <% if (enablephoto) { %>                        <li data-tab=photo data-bypass=1><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="<%= window.joms_current_url %>#joms-icon-camera"></use></svg></li>                        <% } %>                        <% if (enablevideo) { %>                        <li data-tab=video data-bypass=1><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="<%= window.joms_current_url %>#joms-icon-play"></use></svg></li>                        <% } %>                        <% if (enablefile) { %>                        <li data-tab=file data-bypass=1><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="<%= window.joms_current_url %>#joms-icon-file-zip"></use></svg></li>                        <% } %>                        <% if (enablepoll) { %>                        <li data-tab=poll data-bypass=1><svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="<%= window.joms_current_url %>#joms-icon-list"></use></svg></li>                        <% } %>                    </ul>                    <div class=joms-postbox-action>                        <button class=joms-postbox-cancel><%= language.postbox.cancel_button %></button>                        <button class=joms-postbox-save><%= language.postbox.post_button %></button>                    </div>                    <div class=joms-postbox-loading style="display:none;">                        <img src="<%= juri.root %>components/com_community/assets/ajax-loader.gif" alt="loader">                    <div>                </nav>            </div>'),getTemplate:function(){var t=r.get("settings")||{},e=r.get("conf")||{},i=!0,s=!0,o=!0,n=!0,t=((t.isProfile||t.isGroup||t.isEvent||t.isPage)&&(e.enablephotos||(i=!1),e.enablevideos||(s=!1),e.enablefiles||(o=!1),e.enablepolls||(n=!1)),this.template({juri:r.get("juri"),enablephoto:i,enablevideo:s,enablefile:o,enablepoll:n,language:{postbox:h.get("postbox")||{},status:h.get("status")||{}}}));return a(t).hide()},events:a.extend({},i.prototype.events,{"click li[data-tab=photo]":"onAddPhoto","click li[data-tab=video]":"onAddVideo","click li[data-tab=file]":"onAddFile","click li[data-tab=poll]":"onAddPoll"}),initialize:function(){var t=r.get("settings")||{},t=((this.inheritPrivacy=t.isPage||t.isGroup||t.isEvent||!t.isMyProfile)&&(this.subviews=a.omit(this.subviews,"privacy")),r.get("moods"));this.enableMood=+r.get("conf.enablemood")&&t&&t.length,this.enableMood||(this.subviews=a.omit(this.subviews,"mood")),this.enableLocation=+r.get("conf.enablelocation"),this.enableLocation||(this.subviews=a.omit(this.subviews,"location")),i.prototype.initialize.apply(this)},render:function(){var t,e;return i.prototype.render.apply(this),this.$inputbox=this.$(".joms-postbox-inputbox"),this.$fetcher=this.$(".joms-postbox-fetched"),this.$tabmood=this.$tabs.find("[data-tab=mood]"),this.$tablocation=this.$tabs.find("[data-tab=location]"),this.$tabprivacy=this.$tabs.find("[data-tab=privacy]"),this.enableMood||this.$tabmood.remove(),this.enableLocation||this.$tablocation.remove(),this.inheritPrivacy&&(this.$tabprivacy.next().length?this.$tabprivacy.remove():this.$tabprivacy.css({visibility:"hidden"})),this.inputbox=new o({attachment:!0,charcount:!0,status:!0}),this.assign(this.$inputbox,this.inputbox),this.listenTo(this.inputbox,"focus",this.onInputFocus),this.listenTo(this.inputbox,"keydown",this.onInputUpdate),this.listenTo(this.inputbox,"paste",this.onInputUpdate),this.listenTo(this.inputbox,"change:type",this.onInputChangeType),this.inheritPrivacy||((e=r.get("settings")||{}).isProfile&&e.isMyProfile&&(t=r.get("conf.profiledefaultprivacy")),this.initSubview("privacy",{privacylist:window.joms_privacylist,defaultPrivacy:t||"public"})),this.single&&this.listenTo(a,"click",this.onDocumentClick),this},reset:function(){i.prototype.reset.apply(this),this.inputbox&&this.inputbox.reset(),this.fetcher&&this.fetcher.remove()},value:function(){var t,e;for(e in this.data.text=this.inputbox.value()||"",this.data.text=this.data.text.replace(/\n/g,"\\n"),this.data.attachment={},this.inputbox.colorful&&(this.data.attachment.colorful=!0,this.data.attachment.bgid=this.inputbox.bgid),this.subflags)(t=this.subviews[e].value())&&(this.data.attachment[e]=t);return this.fetcher&&(this.data.attachment.fetch=this.fetcher.value()),i.prototype.value.apply(this,arguments)},validate:a.noop,onInputChangeType:function(t){t?(this.$tabmood.attr("style","display: none !important"),this.$tablocation.attr("style","display: none !important")):(this.$tabmood.attr("style",""),this.$tablocation.attr("style",""))},onInputFocus:function(){this.showMainState()},onInputUpdate:function(t,e){this.togglePostButton(t=t||""),32===e||13===e?this.fetch(t):this.fetchProxy(t)},fetchProxy:a.debounce(function(t){this.fetch(t)},1e3),fetch:function(t){var e;this.fetcher&&(this.fetcher.fetching||this.fetcher.fetched)||(this.fetcher&&this.fetcher.remove(),e=a("<div>").appendTo(this.$fetcher),this.fetcher=new s,this.fetcher.setElement(e),this.listenTo(this.fetcher,"fetch:start",this.onFetchStart),this.listenTo(this.fetcher,"fetch:done",this.onFetchDone),this.listenTo(this.fetcher,"remove",this.onFetchRemove),this.fetcher.fetch(t.replace(/^\s+|\s+$/g,"")))},onFetchStart:function(){this.saving=!0,this.$loading.show()},onFetchDone:function(){this.$loading.hide(),this.saving=!1},onFetchRemove:function(){this.fetcher=!1},onDocumentClick:function(t){t.closest(".joms-postbox").length||this.inputbox.value().replace(/^\s+|\s+$/g,"")||this.showInitialState()},onMoodSelect:function(t){this.inputbox.updateAttachment(t),this.togglePostButton()},onMoodRemove:function(){this.inputbox.updateAttachment(!1),this.togglePostButton()},onLocationSelect:function(t){this.inputbox.updateAttachment(null,t),this.togglePostButton()},onLocationRemove:function(){this.inputbox.updateAttachment(null,!1),this.togglePostButton()},onPrivacySelect:function(t){var e=(e=this.$tabprivacy.find("use").attr("xlink:href")).replace(/#.+$/,"#joms-icon-"+t.icon);this.$tabprivacy.find("use").attr("xlink:href",e),this.$tabprivacy.find("span").html(t.label)},onAddPhoto:function(){t.postbox||(t.postbox={}),t.postbox.value=this.value(!0),t.postbox.value[0]=t.postbox.value[0].replace(/\\n/g,"\n"),a.trigger("postbox:photo")},onAddVideo:function(){t.postbox||(t.postbox={}),t.postbox.value=this.value(!0),t.postbox.value[0]=t.postbox.value[0].replace(/\\n/g,"\n"),a.trigger("postbox:video")},onAddFile:function(){t.postbox||(t.postbox={}),t.postbox.value=this.value(!0),t.postbox.value[0]=t.postbox.value[0].replace(/\\n/g,"\n"),a.trigger("postbox:file")},onAddPoll:function(){t.postbox||(t.postbox={}),t.postbox.value=this.value(!0),t.postbox.value[0]=t.postbox.value[0].replace(/\\n/g,"\n"),a.trigger("postbox:poll")},getStaticAttachment:function(){return this.staticAttachment||(this.staticAttachment=a.extend({},r.get("postbox.attachment")||{},{type:"message"})),this.staticAttachment},togglePostButton:function(t){t=!!t;!(t=!t&&this.subflags.mood?this.subviews.mood.value():t)&&this.subflags.location&&(t=this.subviews.location.value()),this.$save[t?"show":"hide"]()}})}),define("views/widget/select",["sandbox","views/base","utils/language"],function(i,t,e){return t.extend({template:joms.jst["html/widget/select"],events:{"click span":"toggle","click svg":"toggle","click li":"onSelect"},initialize:function(t){this.options=t.options||[],+t.width&&(this.width=+t.width+"px")},render:function(){var t={};t.options=this.options,t.width=this.width||!1,t.placeholder=e.get("select_category"),this.$el.html(this.template(t)),this.$span=this.$("span"),this.$ul=this.$("ul"),t.options&&6<t.options.length&&this.$ul.css({height:"175px",overflowY:"auto"})},select:function(t,e){this.$span.html(e),this.$span.data("value",t),this.trigger("select",t,e)},toggle:function(){this.$ul.toggle()},value:function(){return this.$span.data("value")},reset:function(){this.$ul&&this.$ul.hide(),this.options&&this.options.length&&(this.$span.html(this.options[0][1]),this.$span.data("value",this.options[0][0]))},onSelect:function(t){var t=i(t.currentTarget),e=t.data("value"),t=t.html();this.select(e,t),this.toggle()}})}),define("views/widget/select-album",["sandbox","views/widget/select","utils/language"],function(i,t,e){return t.extend({template:joms.jst["html/widget/select-album"],render:function(){var t={};t.options=this.options,t.width=this.width||!1,t.placeholder=e.get("select_category"),this.$el.html(this.template(t)),this.$span=this.$("span"),this.$ul=this.$("ul"),t.options&&(3<t.options.length&&this.$ul.css({height:"160px",overflowY:"auto"}),t.options[0]&&this.select(t.options[0][0],t.options[0][1]))},onSelect:function(t){var t=i(t.currentTarget),e=t.data("value"),t=t.find("p").html();this.select(e,t),this.toggle()}})}),define("views/postbox/photo-preview",["sandbox","app","views/base","views/widget/select-album","utils/ajax","utils/constants","utils/language"],function(h,d,t,c,e,p,u){return t.extend({templates:{div:joms.jst["html/postbox/photo-preview"],img:joms.jst["html/postbox/photo-item"]},events:{"click .joms-postbox-photo-remove":"onRemove"},render:function(){this.$el.html(this.templates.div()),this.$list=this.$("ul"),this.$form=this.$("div.joms-postbox-photo-form")},add:function(t){this.$list.append(this.templates.img({id:this.getFileId(t),src:d.legacyUrl+"/assets/photo-upload-placeholder.png"}));t=p.get("settings")||{};if(t.isMyProfile&&!this.select){var e=p.get("album"),i=u.get("privacy"),s=[],o={0:"public",10:"public",20:"site_members",30:"friends",40:"me"},n={0:"earth",10:"public",20:"users",30:"user",40:"lock"};if(e&&e.length){this.albummap={};for(var a,l,r=0;r<e.length;r++)l=""+(a=e[r]).permissions,this.albummap[""+a.id]=l,s[+(a=[a.id,a.name,i[o[l]||"0"],n[l||"0"]]).default?"unshift":"push"](a);this.select=new c({options:s});t=h('<div class="joms-postbox-select-album joms-select" style="padding:3px 0">').insertAfter(this.$form);this.assign(t,this.select)}}},value:function(){var t=p.get("settings")||{},e={id:this.pics||[]};return this.select&&t.isMyProfile&&(e.album_id=""+this.select.value(),e.privacy=this.albummap[void 0]),e},updateProgress:function(t){var e=this.getFileId(t),e=this.$list.find("#"+e).find(".joms-postbox-photo-progress");e&&e.length&&(t=Math.min(100,Math.floor(t.loaded/t.size*100)),e.stop().animate({width:t+"%"}))},setImage:function(t,e){e=e||{};var t=this.$list.find("#"+this.getFileId(t)),i=p.get("juri.base")+e.thumbnail,e=e.id;t.find("img").attr("src",i).data("id",e),t.find("img").attr("style","visibility:visible"),t.find(".joms-postbox-photo-action").show(),t.addClass("joms-postbox-photo-loaded"),t.find(".joms-postbox-photo-progressbar").remove(),this.pics||(this.pics=[]),this.pics.push(""+e),this.trigger("update",this.pics.length)},removeFailed:function(){this.$list.find(".joms-postbox-photo-item").not(".joms-postbox-photo-loaded").remove(),this.trigger("update",this.pics&&this.pics.length||0)},onRemove:function(t){var t=h(t.target).closest("li"),e=t.find("img").data("id");t.remove(),this.pics=h.without(this.pics,""+e),(t=this.pics.length)<=0&&this.select&&this.select.remove(),this.ajaxRemove([e]),this.trigger("update",t)},remove:function(){return this.pics&&this.pics.length&&this.ajaxRemove(this.pics),t.prototype.remove.apply(this,arguments)},ajaxRemove:function(t){var e={option:"community",no_html:1,task:"azrul_ajax",func:"system,ajaxDeleteTempImage"};e[window.jax_token_var]=1,t&&t.length&&(e["arg2[]"]=t),h.ajax({url:window.jax_live_site,type:"post",dataType:"json",data:e})},getFileId:function(t){return"postbox-preview-"+t.id},getNumPics:function(){return this.$list.find("li").length}})}),define("views/postbox/gif-preview",["views/postbox/photo-preview"],function(t){return t.extend({render:function(){t.prototype.render.apply(this,arguments),this.$el.addClass("joms-postbox-gif-preview")},add:function(){t.prototype.add.apply(this,arguments),this.$el.find(".joms-postbox-select-album").hide()},setImage:function(t,e){e=e||{};var t=this.$list.find("#"+this.getFileId(t)),i=e.image,e=e.id;t.find("img").attr("src",i).data("id",e),t.find("img").attr("style","visibility:visible"),t.find(".joms-postbox-photo-action").show(),t.addClass("joms-postbox-photo-loaded"),t.find(".joms-postbox-photo-progressbar").remove(),this.pics||(this.pics=[]),this.pics.push(""+e),this.trigger("update",this.pics.length)}})}),define("views/inputbox/photo",["sandbox","views/inputbox/status","utils/constants","utils/language"],function(e,o,n,a){return o.extend({template:joms.jst["html/inputbox/base"],initialize:function(){var t,e,i,s;if(o.prototype.initialize.apply(this,arguments),this.hint={single:a.get("status.photo_hint")||"",multiple:a.get("status.photos_hint")||""},this.moods=n.get("moods"),t={},this.moods&&this.moods.length)for(s=0;s<this.moods.length;s++)e=[i=this.moods[s].id,this.moods[s].description],this.moods[s].custom&&(e[2]=this.moods[s].image),t[i]=e;this.moods=t},reset:function(){o.prototype.reset.apply(this,arguments),this.single()},single:function(){this.hint.current=this.hint.single,this.$textarea.attr("placeholder")&&this.$textarea.attr("placeholder",this.hint.current)},multiple:function(){this.hint.current=this.hint.multiple,this.$textarea.attr("placeholder")&&this.$textarea.attr("placeholder",this.hint.current)},updateAttachment:function(t){var e=[];this.mood=t||!1===t?t:this.mood,this.mood&&this.moods[this.mood]&&(void 0!==this.moods[this.mood][2]?e.push('<img class="joms-emoticon" src="'+this.moods[this.mood][2]+'"> <b>'+this.moods[this.mood][1]+"</b>"):e.push('<i class="joms-emoticon joms-emo-'+this.mood+'"></i> <b>'+this.moods[this.mood][1]+"</b>")),e.length?(this.$attachment.html(" &nbsp;&mdash; "+e.join(" "+a.get("and")+" ")+"."),this.$textarea.removeAttr("placeholder")):(this.$attachment.html(""),this.$textarea.attr("placeholder",this.hint.current))},getTemplate:function(){var t=this.template({placeholder:this.hint.current=this.hint.single});return e(t)}})}),define("utils/uploader",["sandbox","app"],function(o,i){var n={runtimes:"html5,html4",url:"index.php"};function t(t){var e;this.queue=[],this.ready=!1,window.plupload?(this.ready=!0,this.create(t)):(e=this,joms.$LAB.script(i.legacyUrl+"assets/vendors/plupload.min.js").wait(function(){e.ready=!0,e.create(t),e.execQueue()}))}return t.prototype.create=function(t){var e,i=this.$button=t.browse_button,s=!1;"string"==typeof t.container?(e=o("#"+t.container)).length||(e=o('<div id="'+t.container+'" style="width:1px; height:1px; overflow:hidden">').appendTo(document.body)):(s=(e=o(t.container)).attr("id"))?t.container=s:(t.container=s=o.uniqueId("uploader_parent_"),e.attr("id",s)),"string"==typeof i?(this.$button=o("#"+i),this.$button.length||(this.$button=o('<button id="'+i+'">').appendTo(e))):(s=i.attr("id"))?this.$button=o(document.getElementById(s)):(t.browse_button=s=o.uniqueId("uploader_"),i.attr("id",s)),this.onProgress=t.onProgress||o.noop,this.onAdded=t.onAdded||o.noop,t=o.extend({},n,t||{}),this.uploader=new plupload.Uploader(t)},t.prototype.init=function(){this.ready?(this.uploader.init(),this.uploader.bind("FilesAdded",this.onAdded),this.uploader.bind("Error",this.onError),this.uploader.bind("BeforeUpload",this.onBeforeUpload),this.uploader.bind("UploadProgress",this.onProgress),this.uploader.bind("FileUploaded",this.onUploaded),this.uploader.bind("UploadComplete",this.onComplete)):this.queue.push(["init",this,arguments])},t.prototype.open=function(){this.ready?this.$button.click():this.queue.push(["open",this,arguments])},t.prototype.reset=function(){this.ready||this.queue.push(["reset",this,arguments])},t.prototype.remove=function(){this.ready||this.queue.push(["remove",this,arguments])},t.prototype.params=function(t){this.uploader.settings.multipart_params=t},t.prototype.upload=function(){this.ready||this.queue.push(["upload",this,arguments])},t.prototype.execQueue=function(){for(var t;this.queue.length;)t=this.queue.shift(),this[t[0]].apply(t[1],t[2])},t.prototype.onAdded=o.noop,t.prototype.onError=o.noop,t.prototype.onBeforeUpload=o.noop,t.prototype.onProgress=o.noop,t.prototype.onUploaded=o.noop,t.prototype.onComplete=o.noop,t}),define("views/postbox/photo",["sandbox","app","views/postbox/default","views/postbox/photo-preview","views/postbox/gif-preview","views/inputbox/photo","views/dropdown/mood","views/widget/select","utils/constants","utils/language","utils/uploader"],function(h,t,i,d,s,o,e,n,c,p,a){return i.extend({subviews:{mood:e},template:joms.jst["html/postbox/photo"],events:h.extend({},i.prototype.events,{"click .joms-postbox-photo-upload":"onPhotoAdd","click li[data-tab=upload]":"onPhotoAdd","click .joms-postbox-gif-upload":"onGifAdd",dragenter:"onDragEnter","dragleave #joms-postbox-photo--droparea":"onDragLeave","drop #joms-postbox-photo--droparea":"onFileDrop"}),initialize:function(){var t=c.get("moods");this.enableMood=+c.get("conf.enablemood")&&t&&t.length,this.enableMood||(this.subviews=h.omit(this.subviews,"mood")),this.enableGif=+c.get("conf.enablephotosgif"),i.prototype.initialize.apply(this)},render:function(){i.prototype.render.apply(this),this.$el.find(".joms-icon--emoticon").data("editor",this),this.$initial=this.$(".joms-postbox-inner-panel"),this.$main=this.$(".joms-postbox-photo"),this.$inputbox=this.$(".joms-postbox-inputbox"),this.$preview=this.$(".joms-postbox-preview"),this.$tabupload=this.$tabs.find("[data-tab=upload]"),this.$tabmood=this.$tabs.find("[data-tab=mood]"),this.$dropArea=this.$el.find("#joms-postbox-photo--droparea"),this.enableMood||this.$tabmood.remove(),this.$uploader=this.$("#joms-postbox-photo-upload"),this.$uploaderParent=this.$uploader.parent(),this.inputbox=new o({attachment:!0,charcount:!0}),this.assign(this.$inputbox,this.inputbox),this.listenTo(this.inputbox,"focus",this.onInputFocus);var t=joms.BASE_URL+"index.php?option=com_community&view=photos&task=ajaxPreview",e=c.get("settings")||{},e=(e.isGroup&&(t+="&no_html=1&tmpl=component&groupid="+(c.get("groupid")||"")),e.isEvent&&(t+="&no_html=1&tmpl=component&eventid="+(c.get("eventid")||"")),e.isPage&&(t+="&no_html=1&tmpl=component&pageid="+(c.get("pageid")||"")),h.ie&&(this.$uploader.appendTo(document.body),this.$uploader.show()),this.maxFileSize=+c.get("conf.maxuploadsize")||0,this.uploading=[],{container:"joms-postbox-photo-upload",drop_element:"joms-postbox-photo--droparea",browse_button:"joms-postbox-photo-upload-btn",url:t,filters:[{title:"Image files",extensions:"jpg,jpeg,png,gif"}],max_file_size:this.maxFileSize+"mb"});return h.mobile||(e.resize={width:2100,height:2100,quality:90}),this.uploader=new a(e),this.uploader.onAdded=h.bind(this.onPhotoAdded,this),this.uploader.onError=h.bind(this.onPhotoError,this),this.uploader.onProgress=h.bind(this.onPhotoProgress,this),this.uploader.onUploaded=h.bind(this.onPhotoUploaded,this),this.uploader.init(),h.ie&&(this.$uploader.hide(),this.$uploader.appendTo(this.$uploaderParent)),this.enableGif&&(e={container:"joms-postbox-gif-upload",browse_button:"joms-postbox-gif-upload-btn",url:t+"&gifanimation=1",filters:[{title:"Image files",extensions:"gif"}],max_file_size:this.maxFileSize+"mb",multi_selection:!1},this.gifuploader=new a(e),this.gifuploader.onAdded=h.bind(this.onGifAdded,this),this.gifuploader.onError=h.bind(this.onGifError,this),this.gifuploader.onProgress=h.bind(this.onGifProgress,this),this.gifuploader.onUploaded=h.bind(this.onGifUploaded,this),this.gifuploader.init()),this},showInitialState:function(){this.$main.hide(),this.$initial.show(),h.ie&&h.ieVersion<10&&this.ieUploadButtonFix(!0),this.inputbox&&this.inputbox.single(),this.preview&&this.preview.remove(),this.preview=!1,this.gifPreview&&this.gifPreview.remove(),this.gifPreview=!1,this.showMoreButton(),i.prototype.showInitialState.apply(this)},showMainState:function(){i.prototype.showMainState.apply(this),this.$action.hide(),this.$initial.hide(),this.$main.show(),this.$save.show(),h.ie&&h.ieVersion<10&&this.ieUploadButtonFix(),t.postbox&&t.postbox.value&&t.postbox.value.length&&(this.inputbox.set(t.postbox.value[0]),t.postbox.value=!1)},showMoreButton:function(){this.$tabupload.removeClass("hidden invisible")},hideMoreButton:function(){this.$tabupload.addClass(this.subviews.mood?"hidden":"invisible")},reset:function(){i.prototype.reset.apply(this),this.inputbox&&this.inputbox.reset(),this.preview&&this.preview.remove(),this.preview=!1,this.gifPreview&&this.gifPreview.remove(),this.gifPreview=!1,this.uploading=[]},value:function(){var t,e;for(e in this.data.text=this.inputbox.value()||"",this.data.attachment={},this.data.text=this.data.text.replace(/\n/g,"\\n"),this.subflags)(t=this.subviews[e].value())&&(this.data.attachment[e]=t);return this.preview?h.extend(this.data.attachment,this.preview.value()):this.gifPreview&&h.extend(this.data.attachment,this.gifPreview.value()),i.prototype.value.apply(this,arguments)},validate:function(){var t=this.value(!0)[1]||{};if(!t.id&&t.id.length)return"No image selected."},onPhotoAdd:function(){var t,e,i;this.uploading.length||(t=+(i=c.get("conf")||{}).limitphoto,e=+i.uploadedphoto,+i.num_photo_per_upload<=(i=this.preview?this.preview.getNumPics():0)?window.alert(p.get("photo.batch_notice")):t<=(e+=i)?window.alert(p.get("photo.upload_limit_exceeded")||"You have reached the upload limit."):window.opera||h.ie&&10===h.ieVersion?this.$("#joms-postbox-photo-upload").find("input[type=file]").click():this.uploader.open())},onPhotoAdded:function(e,t){if(!this.uploading.length&&t&&t.length){var i=this.maxFileSize,s=(t=_.filter(t,function(t){t=t.name.split(".").pop();return _.contains("jpg,jpeg,png,gif,JPG,JPEG,PNG,GIF".split(","),t)}),t=_.filter(t,function(t){return t.size<=1024*i*1024}),c.get("conf")||{}),o=+s.limitphoto,n=+s.uploadedphoto,a=+s.num_photo_per_upload,s=this.preview?this.preview.getNumPics():0;if(s+t.length>a)window.alert(p.get("photo.batch_notice")),_.each(t,function(t){e.removeFile(t)});else if(o<=(n+=s))window.alert(p.get("photo.upload_limit_exceeded")||"You have reached the upload limit."),_.each(t,function(t){e.removeFile(t)});else{n+t.length>o&&(s=n+t.length-o,t.splice(0-s,s),e.splice(0-s,s)),this.preview||(n=h("<div>").appendTo(this.$preview),this.preview=new d,this.assign(n,this.preview),this.listenTo(this.preview,"update",function(t){!t||t<=0?(this.showInitialState(),this.inputbox.single(),this.uploading=[]):(a<=t?this.hideMoreButton():this.showMoreButton(),this.inputbox[1<t?"multiple":"single"]())})),this.showMainState();for(var l=0;l<t.length;l++)this.preview.add(t[l]);var r=this;_.each(t,function(t){r.uploading.push(t.id)}),this.$action.hide(),e.start(),e.refresh()}}},onPhotoError:function(t,e){+e.code==+plupload.FILE_EXTENSION_ERROR?window.alert("Photos: Selected file type is not permitted."):+e.code==+plupload.FILE_SIZE_ERROR?window.alert(p.get("photo.max_upload_size_error")):console.log(e.message)},onPhotoProgress:function(t,e){this.preview&&this.preview.updateProgress(e)},onPhotoUploaded:function(t,e,i){var s;try{s=JSON.parse(i.response)}catch(t){}(s=s||{}).thumbnail?(this.uploading=_.without(this.uploading,e.id),0===this.uploading.length&&this.$action.show(),this.preview&&this.preview.setImage(e,s)):(t.stop(),t.splice(),window.alert(s&&s.msg||"Undefined error."),this.uploading=[],this.$action.show(),this.preview&&this.preview.removeFailed())},onGifAdd:function(){this.hideMoreButton(),this.gifuploader.open()},onGifAdded:function(t,e){var i;this.gifPreview||(i=h("<div>").appendTo(this.$preview),this.gifPreview=new s,this.assign(i,this.gifPreview),this.listenTo(this.gifPreview,"update",function(t){!t||t<=0?(this.showInitialState(),this.inputbox.single(),this.uploading=[]):(this.hideMoreButton(),this.inputbox.single())})),this.showMainState(),this.gifPreview.add(e[0]),t.start(),t.refresh()},onGifError:function(t,e){+e.code==+plupload.FILE_EXTENSION_ERROR?window.alert("Gifs: Selected file type is not permitted."):+e.code==+plupload.FILE_SIZE_ERROR?window.alert(p.get("photo.max_upload_size_error")):console.log(e.message)},onGifProgress:function(t,e){this.gifPreview.updateProgress(e)},onGifUploaded:function(t,e,i){var s;try{s=JSON.parse(i.response)}catch(t){}(s=s||{}).image?(this.$action.show(),this.gifPreview&&this.gifPreview.setImage(e,s)):(t.stop(),t.splice(),window.alert(s&&s.msg||"Undefined error."),this.$action.show(),this.gifPreview&&this.gifPreview.removeFailed())},onDragEnter:function(t){t.preventDefault(),this.$dropArea.show(),this.$dropArea.css("line-height",this.$dropArea.height()+"px")},onDragLeave:function(t){t.preventDefault(),this.$dropArea.hide()},onFileDrop:function(t){t.preventDefault(),this.$dropArea.hide()},onMoodSelect:function(t){this.inputbox.updateAttachment(t)},onMoodRemove:function(){this.inputbox.updateAttachment(!1)},getTemplate:function(){var t=this.template({juri:c.get("juri"),allowgif:c.get("conf.enablephotosgif")||!1,language:{postbox:p.get("postbox")||{},status:p.get("status")||{},photo:p.get("photo")||{}}});return h(t).hide()},getStaticAttachment:function(){return this.staticAttachment||(this.staticAttachment=h.extend({},c.get("postbox.attachment")||{},{type:"photo"})),this.staticAttachment},ieUploadButtonFix:function(t){this.ieUploadButtonFix.init||(this.ieUploadButtonFix.init=!0,this.$uploader.css({display:"block",position:"absolute",opacity:0,width:"",height:""}).children("button,form").css({display:"block",position:"absolute",width:"",height:"",top:0,right:0,bottom:0,left:0}).children("input").css({cursor:"pointer",height:"100%"})),t?(this.$uploader.appendTo(this.$uploaderParent),this.$uploader.css({top:12,right:12,bottom:12,left:12}).children("form").css({width:"100%",height:"100%"})):(this.$uploader.appendTo(this.$tabupload),this.$uploader.css({top:0,right:0,bottom:0,left:0}))}})}),define("views/inputbox/videourl",["sandbox","views/inputbox/base","utils/language"],function(i,e,s){return e.extend({template:joms.jst["html/inputbox/videourl"],render:function(){var t=this.getTemplate();this.$el.replaceWith(t),this.setElement(t),e.prototype.render.apply(this,arguments)},onKeydown:function(t){t&&13===t.keyCode&&t.preventDefault();var e=this;i.defer(function(){e.updateInput(t)})},getTemplate:function(){var t=s.get("video.link_hint")||"",t=this.template({placeholder:t});return i(t)}})}),define("views/postbox/fetcher-video",["sandbox","views/base","views/widget/select","utils/ajax","utils/language"],function(s,t,n,o,a){return t.extend({template:joms.jst["html/postbox/fetcher-video"],events:{"click .joms-fetched-close":"onClose","click .joms-fetched-field span":"onFocus","keyup .joms-fetched-field input":"onKeyup","keyup .joms-fetched-field textarea":"onKeyup","blur .joms-fetched-field input":"onBlur","blur .joms-fetched-field textarea":"onBlur"},initialize:function(){var t=a.get("fetch")||{};this.titlePlaceholder=t.title_hint||"",this.descPlaceholder=t.description_hint||"",t=a.get("video"),this.categoryLabel=t.category_label},fetch:function(t){var e,i=t.match(/^(|.*\s)(https?:\/\/|www\.)([a-z0-9-]+\.)+[a-z]{2,18}(:\d+)?(\/.*)?(\s.*|)$/i);!this.fetching&&i&&(this.id=!1,this.url=t,this.fetching=!0,this.fetched=!1,this.trigger("fetch:start"),o({fn:"videos,ajaxLinkVideoPreview",data:[t],complete:function(){e.fetching=!1,e.trigger("fetch:done")},success:s.bind((e=this).render,this)}))},render:function(t){if(t=this.parseResponse(t)){var e=t&&t.video,i=this.sortCategories(t&&t.category||[]);if(e&&e.id){this.video_id=e.id,this.fetched=!0;for(var e={title:e.title||"",titlePlaceholder:this.titlePlaceholder,description:e.description||"",descPlaceholder:this.descPlaceholder,image:e.thumb||!1,lang:{cancel:(a.get("cancel")||"").toLowerCase()}},s=(this.select&&this.select.remove(),this.$el.html(this.template(e)),this.$image=this.$(".joms-fetched-images").find("img"),this.$title=this.$(".joms-fetched-title").find("input"),this.$description=this.$(".joms-fetched-description").find("textarea"),this.$category=this.$(".joms-fetched-category"),[]),o=0;o<i.length;o++)s.push([i[o].id,this.categoryLabel+": "+i[o].name]);return this.select=new n({options:s}),this.assign(this.$category,this.select),this}this.trigger("fetch:failed",t)}else this.trigger("fetch:failed")},change:function(t){var t=s(t),e=t.prev("span"),i=(i=t.val().replace(/^\s+|\s+$/g,""))||(t.parent().hasClass("joms-fetched-title")?this.titlePlaceholder:this.descPlaceholder);t.hide(),e.text(i).show()},remove:function(){t.prototype.remove.apply(this),this.trigger("remove")},value:function(){return this.fetching?[]:[this.video_id,this.url,this.$image&&this.$image.attr("src"),this.$title&&this.escapeValue(this.$title.val()),this.$description&&this.escapeValue(this.$description.val()),this.select&&this.select.value()]},onClose:function(){this.remove()},onFocus:function(t){var t=s(t.currentTarget),e=t.next("input,textarea");t.hide(),e.show(),setTimeout(function(){e[0].focus()},300)},onKeyup:function(t){13===t.keyCode&&this.change(t.currentTarget)},onBlur:function(t){this.change(t.currentTarget)},parseResponse:function(t){var e;if(t&&t.length)for(var i=0;i<t.length;i++){if("__throwError"===t[i][1]){e={msg:t[i][3]};break}if("__callback"===t[i][1]){e=t[i][3][0];break}}return e},sortCategories:function(t,e,i){if(!t||!t.length)return[];e=e||0,i=i||"";for(var s,o,n=[],a=0;a<t.length;a++)+t[a].parent===e&&(s=+t[a].id,o=i+t[a].name,n.push({id:s,name:o}),n=n.concat(this.sortCategories(t,s,o+" &rsaquo; ")));return n},escapeValue:function(t){return"string"!=typeof t?t:t.replace(/\\/g,"&#92;").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/&quot;/g,'"')}})}),define("views/inputbox/video",["sandbox","views/inputbox/status","utils/language"],function(e,t,i){return t.extend({template:joms.jst["html/inputbox/video"],getTemplate:function(){var t=i.get("status.video_hint")||"",t=this.template({placeholder:t});return e(t)}})}),define("views/postbox/video",["sandbox","app","views/postbox/default","views/inputbox/videourl","views/postbox/fetcher-video","views/inputbox/video","views/dropdown/mood","views/dropdown/location","views/dropdown/privacy","views/widget/select","utils/ajax","utils/constants","utils/language","utils/uploader"],function(l,s,i,o,n,a,t,e,r,h,d,c,p,u){return i.extend({subviews:{mood:t,location:e,privacy:r},template:joms.jst["html/postbox/video"],events:l.extend({},i.prototype.events,{"click [data-action=share]":"onVideoUrl","click [data-action=upload]":"onVideoUpload"}),initialize:function(){this.enableUpload=+c.get("conf.enablevideosupload"),this.enableLocation=+c.get("conf.enablevideosmap");var t=c.get("moods"),t=(this.enableMood=+c.get("conf.enablemood")&&t&&t.length,this.enableMood||(this.subviews=l.omit(this.subviews,"mood")),this.enableLocation||(this.subviews=l.omit(this.subviews,"location")),c.get("settings")||{});(this.inheritPrivacy=t.isPage||t.isGroup||t.isEvent||!t.isMyProfile)&&(this.subviews=l.omit(this.subviews,"privacy")),this.language={postbox:p.get("postbox"),status:p.get("status"),video:p.get("video")},this.onVideoInit(),i.prototype.initialize.apply(this)},render:function(){var t,e;return i.prototype.render.apply(this),this.$initial=this.$(".joms-initial-panel"),this.$main=this.$(".joms-postbox-video"),this.$stateurl=this.$(".joms-postbox-video-state-url"),this.$stateupload=this.$(".joms-postbox-video-state-upload"),this.$url=this.$stateurl.find(".joms-postbox-url"),this.$fetcher=this.$stateurl.find(".joms-postbox-fetched"),this.$file=this.$stateupload.find(".joms-postbox-url"),this.$fileprogress=this.$stateupload.find(".joms-postbox-photo-progress"),this.$title=this.$stateupload.find("input.input"),this.$inputbox=this.$(".joms-postbox-inputbox"),this.$tabupload=this.$tabs.find("[data-tab=upload]"),this.$tabmood=this.$tabs.find("[data-tab=mood]"),this.$tablocation=this.$tabs.find("[data-tab=location]"),this.$tabprivacy=this.$tabs.find("[data-tab=privacy]"),this.enableMood||this.$tabmood.remove(),this.enableLocation||this.$tablocation.remove(),this.inheritPrivacy&&this.$tabprivacy.css({visibility:"hidden"}),this.url=new o,this.assign(this.$url,this.url),this.listenTo(this.url,"focus",this.onUrlFocus),this.listenTo(this.url,"keydown",this.onUrlUpdate),this.inputbox=new a({attachment:!0,charcount:!0}),this.assign(this.$inputbox,this.inputbox),this.listenTo(this.inputbox,"focus",this.onInputFocus),this.inheritPrivacy||((e=c.get("settings")||{}).isProfile&&e.isMyProfile&&(t=c.get("conf.profiledefaultprivacy")),this.initSubview("privacy",{privacylist:window.joms_privacylist,defaultPrivacy:t||"public"})),this},showInitialState:function(){this.reset(),this.$tabs.hide(),this.$action.hide(),this.$save.hide(),this.enableUpload?(this.$main.hide(),this.$initial.show()):this.showUrlState(),this.trigger("show:initial")},showMainState:function(t){t?this.showUploadState():this.showUrlState(),this.$tabs.show(),this.$action.show(),this.trigger("show:main")},showUrlState:function(){this.inputbox.$el.find(".joms-postbox-input-placeholder").html(this.language.status.video_hint),this.$save.html(this.language.postbox.post_button),this.$stateupload.hide(),this.$stateurl.show(),this.$initial.hide(),this.$main.show(),this.upload=!1,s.postbox&&s.postbox.value&&s.postbox.value.length&&(this.inputbox.set(s.postbox.value[0]),s.postbox.value=!1)},showUploadState:function(){var t,e,i;if(!this.uploadcat){for(t=this.sortCategories(c.get("videoCategories")||[]),e=[],i=0;i<t.length;i++)e.push([t[i].id,this.language.video.category_label+": "+t[i].name]);this.uploadcat=new h({options:e}),this.$uploadcat=this.$stateupload.find(".joms-fetched-category"),this.assign(this.$uploadcat,this.uploadcat)}this.inputbox.$el.find(".joms-postbox-input-placeholder").html(this.language.video.upload_hint),this.$save.html(this.language.postbox.upload_button),this.$stateurl.hide(),this.$stateupload.show(),this.$initial.hide(),this.$main.show(),this.$save.show(),this.upload=!0,s.postbox&&s.postbox.value&&s.postbox.value.length&&(this.inputbox.set(s.postbox.value[0]),s.postbox.value=!1)},reset:function(){i.prototype.reset.apply(this),this.url&&this.url.reset(),this.inputbox&&this.inputbox.reset(),this.fetcher&&this.fetcher.remove()},value:function(){var t,e;for(e in this.data.text=this.inputbox.value()||"",this.data.attachment={},this.data.text=this.data.text.replace(/\n/g,"\\n"),this.subflags)(t=this.subviews[e].value())&&(this.data.attachment[e]=t);return this.upload?this.status&&"success"===this.status.status&&(this.data.attachment.fetch=[this.status.videoid]):this.fetcher&&(this.data.attachment.fetch=this.fetcher.value()),i.prototype.value.apply(this,arguments)},validate:function(){var t=(this.value(!0)[1]||{}).fetch;return this.upload?this.uploadcat&&this.uploadcat.value()?void 0:p.get("video.select_category")||"Please select video category.":t&&t.length?t[5]?void 0:p.get("video.select_category")||"Please select video category.":p.get("video.invalid_url")||"Please share a valid video url."},onPost:function(){var t,e;this.saving||((e=this.validate())?window.alert(e):(this.saving=!0,this.$loading.show(),!0===this.upload?this.uploader.uploader.start():(e=(t=this).value(),window.joms_filter_params&&e.push(JSON.stringify(window.joms_filter_params)),window.joms_postbox_posting=!0,d({fn:"system,ajaxStreamAdd",data:e,success:l.bind(this.onPostSuccess,this),complete:function(){window.joms_postbox_posting=!1,t.$loading.hide(),t.saving=!1,t.showInitialState(),+window.joms_infinitescroll&&l(".joms-stream__loadmore").find("a").hide()}}))))},onMoodSelect:function(t){this.inputbox.updateAttachment(t)},onMoodRemove:function(){this.inputbox.updateAttachment(!1)},onLocationSelect:function(t){this.inputbox.updateAttachment(null,t)},onLocationRemove:function(){this.inputbox.updateAttachment(null,!1)},onPrivacySelect:function(t){var e=(e=this.$tabprivacy.find("use").attr("xlink:href")).replace(/#.+$/,"#joms-icon-"+t.icon);this.$tabprivacy.find("use").attr("xlink:href",e),this.$tabprivacy.find("span").html(t.label)},onUrlFocus:function(){this.enableUpload||this.showMainState()},onUrlUpdate:function(t,e){t=t&&t.replace(/^\s+|\s+$/g,""),32===e||13===e?this.fetch(t):this.fetchProxy(t)},onInputFocus:function(){this.enableUpload||this.showMainState()},fetchProxy:l.debounce(function(t){this.fetch(t)},1e3),fetch:function(t){var e;this.fetcher&&(this.fetcher.fetching||this.fetcher.fetched)||(delete this.data.attachment.fetch,e=l("<div>").appendTo(this.$fetcher),this.fetcher&&this.fetcher.remove(),this.fetcher=new n,this.fetcher.setElement(e),this.listenTo(this.fetcher,"fetch:start",this.onFetchStart),this.listenTo(this.fetcher,"fetch:failed",this.onFetchFailed),this.listenTo(this.fetcher,"fetch:done",this.onFetchDone),this.listenTo(this.fetcher,"remove",this.onFetchRemove),this.fetcher.fetch(t))},onFetchStart:function(){this.saving=!0,this.$loading.show(),this.$save.hide()},onFetchFailed:function(t){this.fetcher&&this.fetcher.remove(),this.saving=!1,this.$loading.hide(),this.$save.hide();t=t&&t.msg||"Undefined error.";window.alert(t)},onFetchDone:function(){this.saving=!1,this.$loading.hide(),this.fetcher&&this.fetcher.fetched&&this.$save.show()},onFetchRemove:function(){this.fetcher=!1,this.$save.hide()},onVideoUrl:function(){this.showMainState()},onVideoInit:function(){var t,e,i,s,o,n,a;this.uploader||((t=+c.get("conf.maxvideouploadsize")||0)&&(t+="mb"),e="index.php?option=com_community&view=videos&task=uploadvideo",i=c.get("videocreatortype"),s=c.get("settings")||{},o=+c.get("groupid"),n=+c.get("pageid"),a=+c.get("eventid"),i&&(e+="&creatortype="+i),s.isProfile&&!s.isMyProfile?e+="&target="+c.get("postbox.attachment.target"):0<a?e+="&eventid="+a:0<o?e+="&groupid="+o:0<n&&(e+="&pageid="+n),this.uploader=new u({container:"joms-js--videouploader-upload",browse_button:"joms-js--videouploader-upload-button",url:e,multi_selection:!1,filters:[{title:"Video files",extensions:"3g2,3gp,asf,asx,avi,flv,mov,mp4,mpg,rm,swf,vob,wmv,m4v"}],max_file_size:t}),this.uploader.onAdded=l.bind(this.onVideoAdded,this),this.uploader.onError=l.bind(this.onVideoError,this),this.uploader.onBeforeUpload=l.bind(this.onVideoBeforeUpload,this),this.uploader.onProgress=l.bind(this.onVideoProgress,this),this.uploader.onUploaded=l.bind(this.onVideoUploaded,this),this.uploader.init())},onVideoUpload:function(){var t=c.get("conf")||{};+t.limitvideo<=+t.uploadedvideo?window.alert(p.get("video.upload_limit_exceeded")||"You have reached the upload limit."):(this.uploader.uploader.splice(),this.uploader.open())},onVideoAdded:function(t,e){if(e&&e.length){for(var e=e[0],i="<b>"+e.name+"</b>",s=e.size||0,o="Bytes",n=["KB","MB","GB"];1e3<=s&&n.length;)o=n.shift(),s=Math.ceil(s/1e3);s&&(i+=" ("+s+" "+o+")"),this.$file.html(i),this.$fileprogress.css({width:0}),this.showMainState("upload")}},onVideoError:function(t,e){var i;+e.code==+plupload.FILE_SIZE_ERROR?(i=+c.get("conf.maxvideouploadsize")||0,window.alert("Maximum file size for video upload is "+i+" MB.")):+e.code==+plupload.FILE_EXTENSION_ERROR&&window.alert("Тип файла не поддерживается.")},onVideoBeforeUpload:function(){var t={title:this.$title.val(),description:this.inputbox.value()},e=(this.subflags.privacy&&(t.permissions=this.subviews.privacy.value()),this.subflags.location&&this.subviews.location.value());e&&e.length&&(t.location=e),this.uploadcat&&(t.category_id=this.uploadcat&&this.uploadcat.value()),this.uploader.params(t)},onVideoProgress:function(t,e){e=Math.min(100,Math.round(100*e.loaded/e.size));this.$fileprogress.animate({width:e+"%"})},onVideoUploaded:function(t,e,i){var s,o;try{s=JSON.parse(i.response)}catch(t){}this.status=s||{},o=this,setTimeout(function(){o.$loading.hide(),o.saving=!1,o.showInitialState(),"success"!==o.status.status?window.alert(o.status.message||"Undefined error."):(++(c.get("conf")||{}).uploadedvideo,window.alert(o.status.processing_str))},1e3)},getTemplate:function(){var t=this.template({juri:c.get("juri"),enable_upload:this.enableUpload,video_maxsize:c.get("conf.maxvideouploadsize"),language:{postbox:p.get("postbox")||{},status:p.get("status")||{},video:p.get("video")||{}}});return l(t).hide()},getStaticAttachment:function(){return this.staticAttachment||(this.staticAttachment=l.extend({},c.get("postbox.attachment")||{},{type:"video"})),this.staticAttachment},sortCategories:function(t,e,i){if(!t||!t.length)return[];e=e||0,i=i||"";for(var s,o,n=[],a=0;a<t.length;a++)+t[a].parent===e&&(s=+t[a].id,o=i+t[a].name,n.push({id:s,name:o}),n=n.concat(this.sortCategories(t,s,o+" &rsaquo; ")));return n}})}),define("views/inputbox/eventtitle",["sandbox","views/inputbox/base","utils/language"],function(e,i,s){return i.extend({template:joms.jst["html/inputbox/eventtitle"],render:function(){var t=this.getTemplate();this.$el.replaceWith(t),this.setElement(t),i.prototype.render.apply(this,arguments)},getTemplate:function(){var t=s.get("event.title_hint")||"",t=this.template({placeholder:t});return e(t)}})}),define("views/inputbox/eventdesc",["sandbox","views/inputbox/base","utils/language"],function(e,i,s){return i.extend({template:joms.jst["html/inputbox/eventdesc"],render:function(){var t=this.getTemplate();this.$el.replaceWith(t),this.setElement(t),i.prototype.render.apply(this,arguments)},getTemplate:function(){var t=s.get("status.event_hint")||"",t=this.template({placeholder:t});return e(t)}})}),define("views/dropdown/event",["sandbox","views/dropdown/base","utils/constants","utils/language"],function(a,t,l,r){return t.extend({template:_.template('            <div class="joms-postbox-dropdown event-dropdown">                <div style="clear:both">                    <div class=event-time-column>                    <label class="joms-checkbox">                        <input type="checkbox" class="joms-checkbox private-event" name="permission" value="1">                        <span title="<%= language.event.private_tips %>">                        <%= language.event.private %>                        </span>                    </label>                    </div>                </div>                <div style="clear:both">                    <div class=event-time-column>                        <span>                            <%= language.event.category %>                            <span style="color:red">*</span>                        </span>                        <div class="joms-select--wrapper">                            <select class="joms-event-category joms-select" style="width:100%"></select>                        </div>                    </div>                    <div class=event-time-column>                        <span>                            <%= language.event.location %>                            <span style="color:red">*</span>                        </span>                        <input type=text class=joms-input name=location placeholder="<%= language.event.location_hint %>">                    </div>                </div>                <div style="clear:both">                    <div class=event-time-column>                        <span>                            <%= language.event.start %>                            <span style="color:red">*</span>                        </span>                        <input type=text class="joms-input joms-pickadate-startdate" placeholder="<%= language.event.start_date_hint %>" style="background-color:transparent;cursor:text">                        <input type=text class="joms-input joms-pickadate-starttime" placeholder="<%= language.event.start_time_hint %>" style="background-color:transparent;cursor:text">                        <span class="event-all-day joms-event-allday" style="margin-left:0;visibility:hidden">                            <span>All Day Event</span>                            <span style="position:relative">                                <i class=joms-icon-check-empty></i>                            </span>                        </span>                    </div>                    <div class=event-time-column>                        <span>                            <%= language.event.end %>                            <span style="color:red">*</span>                        </span>                        <input type=text class="joms-input joms-pickadate-enddate" placeholder="<%= language.event.end_date_hint %>" style="background-color:transparent;cursor:text">                        <input type=text class="joms-input joms-pickadate-endtime" placeholder="<%= language.event.end_time_hint %>" style="background-color:transparent;cursor:text">                    </div>                </div>                <nav class="joms-postbox-tab selected">                    <div class="joms-postbox-action event-action">                        <button class=joms-postbox-done><%= language.event.done_button %></button>                    </div>                </nav>            </div>        '),events:{"click .joms-postbox-done":"onSave"},render:function(){var t,e,i=this.getTemplate(),s=+l.get("conf.eventshowampm"),o=+l.get("conf.firstday"),s=s?"h:i A":"H:i",n={};for(n.monthsFull=[r.get("datepicker.january"),r.get("datepicker.february"),r.get("datepicker.march"),r.get("datepicker.april"),r.get("datepicker.may"),r.get("datepicker.june"),r.get("datepicker.july"),r.get("datepicker.august"),r.get("datepicker.september"),r.get("datepicker.october"),r.get("datepicker.november"),r.get("datepicker.december")],n.monthsShort=[],e=0;e<n.monthsFull.length;e++)n.monthsShort[e]=n.monthsFull[e].substr(0,3);for(n.weekdaysFull=[r.get("datepicker.sunday"),r.get("datepicker.monday"),r.get("datepicker.tuesday"),r.get("datepicker.wednesday"),r.get("datepicker.thursday"),r.get("datepicker.friday"),r.get("datepicker.saturday")],n.weekdaysShort=[],e=0;e<n.weekdaysFull.length;e++)n.weekdaysShort[e]=n.weekdaysFull[e].substr(0,3);if(n.today=r.get("datepicker.today"),n.clear=r.get("datepicker.clear"),n.firstDay=o,n.selectYears=200,n.selectMonths=!0,this.$el.replaceWith(i),this.setElement(i),this.$category=this.$(".joms-event-category").empty(),this.$location=this.$("[name=location]").val(""),this.$startdate=this.$(".joms-pickadate-startdate").pickadate(a.extend({},n,{min:new Date,format:"d mmmm yyyy",klass:{frame:"picker__frame startDate"}})),this.$starttime=this.$(".joms-pickadate-starttime").pickatime({interval:15,format:s,formatLabel:s,klass:{frame:"picker__frame startTime"}}),this.$enddate=this.$(".joms-pickadate-enddate").pickadate(a.extend({},n,{format:"d mmmm yyyy",klass:{frame:"picker__frame endDate"}})),this.$endtime=this.$(".joms-pickadate-endtime").pickatime({interval:15,format:s,formatLabel:s,klass:{frame:"picker__frame endTime"}}),this.$done=this.$(".joms-event-done"),(t=l.get("eventCategories")||[])&&t.length)for(e=0;e<t.length;e++)this.$category.append('<option value="'+t[e].id+'">'+t[e].name+"</option>");return this.startdate=this.$startdate.pickadate("picker"),this.starttime=this.$starttime.pickatime("picker"),this.enddate=this.$enddate.pickadate("picker"),this.endtime=this.$endtime.pickatime("picker"),this.startdate.on({set:a.bind(this.onSetStartDate,this)}),this.starttime.on({set:a.bind(this.onSetStartTime,this)}),this.enddate.on({set:a.bind(this.onSetEndDate,this)}),this.endtime.on({set:a.bind(this.onSetEndTime,this)}),this.$private=this.$el.find(".private-event"),this},value:function(){return this.data},reset:function(){this.$category.val(this.$category.find("option").eq(0).attr("value")),this.$location.val(""),this.$startdate.val(""),this.$starttime.val(""),this.$enddate.val(""),this.$endtime.val(""),this.$private.prop("checked",!1)},onSetStartDate:function(t){t=t.select;this.enddate.set({min:new Date(t)},{muted:!0}),this._checkTime()},onSetEndDate:function(t){t=t.select;this.startdate.set({max:new Date(t)},{muted:!0}),this._checkTime()},onSetStartTime:function(){this._checkTime("start")},onSetEndTime:function(){this._checkTime("end")},onSave:function(){var t,e=this.$category.val(),i=this.$location.val(),s=this.startdate.get("select"),o=this.starttime.get("select"),n=this.enddate.get("select"),a=this.endtime.get("select"),e=[e,this.$category.find("[value="+e+"]").text()],s=s&&[this.startdate.get("select","yyyy-mm-dd"),this.startdate.get("value")],o=o&&[this.starttime.get("select","HH:i"),this.starttime.get("value")],n=n&&[this.enddate.get("select","yyyy-mm-dd"),this.enddate.get("value")],a=a&&[this.endtime.get("select","HH:i"),this.endtime.get("value")];this.data={category:e,location:i,startdate:s,starttime:o,enddate:n,endtime:a,allday:!1,private:!!this.$private.is(":checked")},this.data.category?this.data.location?this.data.startdate?this.data.starttime?this.data.enddate?this.data.endtime||(t=r.get("event.end_time_not_selected")):t=r.get("event.start_time_not_selected"):t=r.get("event.end_date_not_selected"):t=r.get("event.start_date_not_selected"):t=r.get("event.location_not_selected"):t=r.get("event.category_not_selected"),t?window.alert(t):(this.trigger("select",this.data),this.hide())},getTemplate:function(){var t=this.template({language:{event:r.get("event")||{}}});return a(t).hide()},_checkTime:function(){var t=this.startdate.get("select"),e=this.enddate.get("select");t&&e&&(e.year<=t.year&&e.month<=t.month&&e.date<=t.date?(e=this.starttime.get("select"),t=this.endtime.get("select"),e?(this.endtime.set({min:[e.hour,e.mins]},{muted:!0}),t&&t.time<e.time&&this.endtime.set({select:[e.hour,e.mins]},{muted:!0})):this.endtime.set({min:!1},{muted:!0}),t?(this.starttime.set({max:[t.hour,t.mins]},{muted:!0}),e&&e.time>t.time&&this.starttime.set({select:[t.hour,t.mins]},{muted:!0})):this.starttime.set({max:!1},{muted:!0})):(this.starttime.set({max:!1},{muted:!0}),this.endtime.set({min:!1},{muted:!0})))}})}),define("utils/format",["sandbox"],function(o){return{pad:function(t,e,i){if(o.isString(t)&&o.isNumber(e)&&!(t.length>=e)){e-=t.length;for(var s=0;s<e;s++)t=(i||" ")+t}return t}}}),define("views/postbox/event",["sandbox","views/postbox/default","views/inputbox/eventtitle","views/inputbox/eventdesc","views/dropdown/event","utils/constants","utils/format","utils/language"],function($,DefaultView,TitleView,InputboxView,EventView,constants,format,language){return DefaultView.extend({subviews:{event:EventView},template:joms.jst["html/postbox/event"],events:$.extend({},DefaultView.prototype.events,{"click .joms-postbox-event-title":"onFocus"}),render:function(){return DefaultView.prototype.render.apply(this),this.$title=this.$(".joms-postbox-title"),this.$inputbox=this.$(".joms-postbox-inputbox"),this.$category=this.$(".joms-postbox-event-label-category"),this.$location=this.$(".joms-postbox-event-label-location"),this.$date=this.$(".joms-postbox-event-label-date"),this.title=new TitleView,this.assign(this.$title,this.title),this.listenTo(this.title,"focus",this.onInputFocus),this.listenTo(this.title,"keydown",this.onNewInputUpdate),this.inputbox=new InputboxView({charcount:!0}),this.assign(this.$inputbox,this.inputbox),this.listenTo(this.inputbox,"focus",this.onInputFocus),this.listenTo(this.inputbox,"keydown",this.onNewInputUpdate),this},reset:function(){DefaultView.prototype.reset.apply(this),this.title&&this.title.reset(),this.inputbox&&this.inputbox.reset(),this.$category&&this.onEventSelect({})},value:function(){var t,e;for(e in this.data.text=this.inputbox.value()||"",this.data.attachment={},this.subflags)(t=this.subviews[e].value())&&(this.data.attachment[e]=t);var i=(this._data.starttime||"").split(":"),s=(this._data.endtime||"").split(":");return $.extend(this.data.attachment,{title:this.title.value(),catid:this._data.category&&this._data.category[0]||null,location:this._data.location,startdate:this._data.startdate,enddate:this._data.enddate,allday:!1,"starttime-hour":i[0]||null,"starttime-min":i[1]||null,"endtime-hour":s[0]||null,"endtime-min":s[1]||null}),DefaultView.prototype.value.apply(this,arguments)},validate:function(){if(!this.value(!0)[0])return"Event description cannot be empty."},onInputFocus:function(){this.showMainState()},onInputUpdate:$.debounce(function(){var t=this.value(!0),e=t[0],t=t[1],i=!0;this.trim(t.title)&&this.trim(e)&&t.catid&&t.location&&t.startdate&&t.enddate&&(t["starttime-hour"]||t["starttime-min"])&&(t["endtime-hour"]||t["endtime-min"])||(i=!1),this.$save[i?"show":"hide"]()},300),onNewInputUpdate:$.debounce(function(){var t=this.value(!0),e=t[0],t=t[1],i=!0;this.trim(t.title)&&this.trim(e)&&t.catid&&t.location&&t.startdate&&t.enddate&&(t["starttime-hour"]||t["starttime-min"])&&(t["endtime-hour"]||t["endtime-min"])||(i=!1),this.$save[i?"show":"hide"]()},300),onPost:function(){var t=constants.get("conf")||{},e=+t.limitevent;e<=+t.createdevent?(t=(t=language.get("event.create_limit_exceeded")||"You have reached the event creation limit.").replace("%1$s",e),window.alert(t)):DefaultView.prototype.onPost.apply(this,arguments)},onPostSuccess:function(){DefaultView.prototype.onPostSuccess.apply(this,arguments);var t=constants.get("conf")||{};t.createdevent=+t.createdevent+1},onEventSelect:function(t){t.category?(this.$category.find(".joms-input-text").html(t.category&&t.category[1]),this.$category.show()):this.$category.hide(),t.location?(this.$location.find(".joms-input-text").html(t.location),this.$location.show()):this.$location.hide();var e=[];t.startdate&&t.enddate?(e.push(t.startdate[1]+" "+t.starttime[1]),e.push(t.enddate[1]+" "+t.endtime[1]),this.$date.find(".joms-input-text").html(e.join(" &mdash; ")),this.$date.show()):this.$date.hide(),t.startdate&&(t.startdate=t.startdate[0]),t.starttime&&(t.starttime=t.starttime[0]),t.enddate&&(t.enddate=t.enddate[0]),t.endtime&&(t.endtime=t.endtime[0]),this._data=t,this.onInputUpdate()},onPrivacySelect:function(t){var e=(e=this.$tabprivacy.find("use").attr("xlink:href")).replace(/#.+$/,"#joms-icon-"+t.icon);this.$tabprivacy.find("use").attr("xlink:href",e),this.$tabprivacy.find("span").html(t.label)},parseResponse:function(response){var elid="activity-stream-container",data,temp;if(response&&response.length)for(var i=0;i<response.length;i++)if(response[i][1]===elid&&(data=response[i][3]),"al"===response[i][0]&&(temp=response[i][3],window.alert($.isArray(temp)?temp.join(". "):temp)),"__throwError"===response[i][1]&&(temp=response[i][3],window.alert($.isArray(temp)?temp.join(". "):temp)),"cs"===response[i][0])try{eval(response[i][1])}catch(e){}return data},getTemplate:function(){var t=language.get("event")||{},t=(t.event_detail&&(t.event_detail=t.event_detail.toLowerCase()),this.template({juri:constants.get("juri"),language:{postbox:language.get("postbox")||{},event:t}}));return $(t).hide()},getStaticAttachment:function(){return this.staticAttachment||(this.staticAttachment=$.extend({},constants.get("postbox.attachment")||{},{type:"event"})),this.staticAttachment},trim:function(t){return(t||"").replace(/^\s+|\s+$/g,"")}})}),define("views/postbox/file-preview",["sandbox","app","views/base","utils/ajax","utils/constants","utils/language"],function(i,h,t,e,d,c){return t.extend({templates:{div:_.template('<div class=joms-postbox-photo-preview>                     <ul class="joms-list clearfix"></ul>                 </div>'),file:_.template('<li id="<%= id %>" data-fileid="" class=joms-postbox-photo-item>                     <div class=img-wrapper>                         <svg viewBox="0 0 16 18" class="joms-icon">                            <use xlink:href="<%= window.joms_current_url %>#joms-icon-file-zip" class="joms-icon--svg-fixed joms-icon--svg-unmodified joms-icon--svg-unmodified"></use>                        </svg>                         <b class="joms-filename"><%= name %></b>                    </div>                     <div class=joms-postbox-photo-action style="display:none">                         <span class=joms-postbox-photo-remove>×</span>                     </div>                     <div class=joms-postbox-file-progressbar>                         <div class=joms-postbox-file-progress></div>                     </div>                 </li>')},events:{"click .joms-postbox-photo-remove":"onRemove"},render:function(){this.$el.html(this.templates.div()),this.$list=this.$el.find("ul.joms-list"),this.$form=this.$el.find("div.joms-postbox-photo-form")},add:function(t){this.$list.append(this.templates.file({id:this.getFileId(t),name:t.name,src:h.legacyUrl+"/assets/photo-upload-placeholder.png"}));t=d.get("settings")||{};if(t.isMyProfile&&!this.select){var e=d.get("album"),i=c.get("privacy"),s=[],o={0:"public",10:"public",20:"site_members",30:"friends",40:"me"},n={0:"earth",10:"public",20:"users",30:"user",40:"lock"};if(e&&e.length){this.albummap={};for(var a,l,r=0;r<e.length;r++)l=""+(a=e[r]).permissions,this.albummap[""+a.id]=l,s[+(a=[a.id,a.name,i[o[l]||"0"],n[l||"0"]]).default?"unshift":"push"](a)}}},value:function(){d.get("settings");return{id:this.files||[]}},updateProgress:function(t){var e=this.getFileId(t),e=this.$list.find("#"+e).find(".joms-postbox-file-progress");e&&e.length&&(t=Math.min(100,Math.floor(t.loaded/t.size*100)),e.stop().animate({width:t+"%"}))},setFile:function(t,e){e=e||{};var i=this.$list.find("#"+this.getFileId(t)),s=e.id;i.find(".joms-filename").text(t.name),i.attr("data-id",e.id),i.find(".joms-postbox-photo-action").show(),i.addClass("joms-postbox-photo-loaded"),i.find(".joms-postbox-photo-progressbar").remove(),this.files||(this.files=[]),this.files.push(""+s),this.trigger("update",this.files.length)},removeFailed:function(){this.$list.find(".joms-postbox-photo-item").not(".joms-postbox-photo-loaded").remove(),this.trigger("update",this.files&&this.files.length||0)},onRemove:function(t){var t=i(t.target).closest("li"),e=t.data("id");t.remove(),this.files=i.without(this.files,""+e),t=this.files.length,this.ajaxRemove([e]),this.trigger("update",t)},remove:function(){return this.files&&this.files.length&&this.ajaxRemove(this.files),t.prototype.remove.apply(this,arguments)},ajaxRemove:function(t){var e={option:"community",no_html:1,task:"azrul_ajax",func:"system,ajaxDeleteTempFile"};e[window.jax_token_var]=1,t&&t.length&&(e["arg2[]"]=t),i.ajax({url:window.jax_live_site,type:"post",dataType:"json",data:e})},getFileId:function(t){return"postbox-preview-"+t.id},getNumFiles:function(){return this.$list.find("li").length}})}),define("views/inputbox/file",["sandbox","views/inputbox/status","utils/constants","utils/language"],function(e,o,n,a){return o.extend({template:joms.jst["html/inputbox/base"],initialize:function(){var t,e,i,s;if(o.prototype.initialize.apply(this,arguments),this.hint={single:a.get("status.file_hint")||"",multiple:a.get("status.files_hint")||""},this.moods=n.get("moods"),t={},this.moods&&this.moods.length)for(s=0;s<this.moods.length;s++)e=[i=this.moods[s].id,this.moods[s].description],this.moods[s].custom&&(e[2]=this.moods[s].image),t[i]=e;this.moods=t},reset:function(){o.prototype.reset.apply(this,arguments),this.single()},single:function(){this.hint.current=this.hint.single,this.$textarea.attr("placeholder")&&this.$textarea.attr("placeholder",this.hint.current)},multiple:function(){this.hint.current=this.hint.multiple,this.$textarea.attr("placeholder")&&this.$textarea.attr("placeholder",this.hint.current)},updateAttachment:function(t){var e=[];this.mood=t||!1===t?t:this.mood,this.mood&&this.moods[this.mood]&&(void 0!==this.moods[this.mood][2]?e.push('<img class="joms-emoticon" src="'+this.moods[this.mood][2]+'"> <b>'+this.moods[this.mood][1]+"</b>"):e.push('<i class="joms-emoticon joms-emo-'+this.mood+'"></i> <b>'+this.moods[this.mood][1]+"</b>")),e.length?(this.$attachment.html(" &nbsp;&mdash; "+e.join(" "+a.get("and")+" ")+"."),this.$textarea.removeAttr("placeholder")):(this.$attachment.html(""),this.$textarea.attr("placeholder",this.hint.current))},getTemplate:function(){var t=this.template({placeholder:this.hint.current=this.hint.single});return e(t)}})}),define("views/postbox/file",["sandbox","app","views/postbox/default","views/postbox/file-preview","views/inputbox/file","views/dropdown/mood","views/dropdown/privacy","utils/constants","utils/language","utils/uploader"],function(d,t,s,c,o,e,i,p,u,n){return s.extend({subviews:{mood:e,privacy:i},template:_.template('<div class="joms-postbox-file-wrapper" style="position: relative;">                <div class="joms-postbox--droparea" id="joms-postbox-file--droparea">                    <%= language.file.drop_to_upload %>                </div>                <div id=joms-postbox-file-upload style="position:absolute;top:0;left:0;width:1px;height:1px;overflow:hidden">                    <button id=joms-postbox-file-upload-btn>Upload</button>                </div>                <div class="joms-postbox-inner-panel" style="position:relative">                    <div class="joms-postbox-file-upload">                        <svg viewBox="0 0 16 18" class="joms-icon">                            <use xlink:href="<%=window.joms_current_url%>#joms-icon-file-zip" class="joms-icon--svg-fixed joms-icon--svg-unmodified"></use>                        </svg>                         <%= language.file.upload_button %>                    </div>                </div>                <div class="joms-postbox-file">                    <div class="joms-postbox-preview"></div>                    <div class=joms-postbox-inputbox></div>                    <nav class="joms-postbox-tab selected">                         <ul class="joms-list inline">                             <li data-tab=upload data-bypass=1>                                <svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="<%= window.joms_current_url %>#joms-icon-file-zip"></use></svg>                                 <span class=visible-desktop><%= language.file.upload_button_more %></span>                            </li>                             <li data-tab=mood>                                <svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="<%= window.joms_current_url %>#joms-icon-happy"></use></svg>                                 <span class=visible-desktop><%= language.status.mood %></span>                            </li>                             <li data-tab=privacy>                                <svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="<%= window.joms_current_url %>#joms-icon-earth"></use></svg>                                 <span class=visible-desktop></span>                            </li>                        </ul>                         <div class=joms-postbox-action>                             <button class=joms-postbox-cancel><%= language.postbox.cancel_button %></button>                             <button class=joms-postbox-save><%= language.postbox.post_button %></button>                         </div>                         <div class=joms-postbox-loading style="display:none;">                             <img src="<%= juri.root%>components/com_community/assets/ajax-loader.gif" alt="loader">                         </div>                     </nav>                </div>            </div>'),getTemplate:function(){var t=this.template({juri:p.get("juri"),language:{postbox:u.get("postbox")||{},status:u.get("status")||{},file:u.get("file")||{},privacy:u.get("privacy")||{}}});return d(t).hide()},events:d.extend({},s.prototype.events,{"click .joms-postbox-file-upload":"onFileAdd","click li[data-tab=upload]":"onFileAdd",dragenter:"onDragEnter","dragleave #joms-postbox-file--droparea":"onDragLeave","drop #joms-postbox-file--droparea":"onFileDrop"}),initialize:function(){var t=p.get("moods"),t=(this.enableMood=+p.get("conf.enablemood")&&t&&t.length,this.enableMood||(this.subviews=d.omit(this.subviews,"mood")),p.get("settings")||{});(this.inheritPrivacy=t.isPage||t.isGroup||t.isEvent||!t.isMyProfile)&&(this.subviews=d.omit(this.subviews,"privacy")),s.prototype.initialize.apply(this)},render:function(){s.prototype.render.apply(this),this.$initial=this.$(".joms-postbox-inner-panel"),this.$main=this.$(".joms-postbox-file"),this.$inputbox=this.$(".joms-postbox-inputbox"),this.$preview=this.$(".joms-postbox-preview"),this.$tabupload=this.$tabs.find("[data-tab=upload]"),this.$tabmood=this.$tabs.find("[data-tab=mood]"),this.$tabprivacy=this.$tabs.find("[data-tab=privacy]"),this.$dropArea=this.$el.find("#joms-postbox-file--droparea"),this.enableMood||this.$tabmood.remove(),this.$uploader=this.$("#joms-postbox-photo-upload"),this.$uploaderParent=this.$uploader.parent(),this.inputbox=new o({attachment:!0,charcount:!0}),this.assign(this.$inputbox,this.inputbox),this.listenTo(this.inputbox,"focus",this.onInputFocus),this.uploading=[];var t=joms.BASE_URL+"index.php?option=com_community&view=files&task=multiUpload&type=activities",e=p.get("settings")||{},e=(e.isGroup&&(t+="&no_html=1&tmpl=component&groupid="+(p.get("groupid")||"")),e.isEvent&&(t+="&no_html=1&tmpl=component&eventid="+(p.get("eventid")||"")),e.isPage&&(t+="&no_html=1&tmpl=component&pageid="+(p.get("pageid")||"")),this.inheritPrivacy&&this.$tabprivacy.css({visibility:"hidden"}),this.inheritPrivacy||((e=p.get("settings")||{}).isProfile&&e.isMyProfile&&(i=p.get("conf.profiledefaultprivacy")),this.initSubview("privacy",{privacylist:window.joms_privacylist,defaultPrivacy:i||"public"})),d.ie&&(this.$uploader.appendTo(document.body),this.$uploader.show()),p.get("conf")||{}),i=(this.maxFileSize=1,this.maxFileSize=+p.get("settings.isProfile")?e.file_sharing_activity_max:this.maxFileSize,this.maxFileSize=+p.get("settings.isPage")?e.file_sharing_page_max:this.maxFileSize,this.maxFileSize=+p.get("settings.isGroup")?e.file_sharing_group_max:this.maxFileSize,this.maxFileSize=+p.get("settings.isEvent")?e.file_sharing_event_max:this.maxFileSize,this.ext="zip",this.ext=+p.get("settings.isProfile")?e.file_activity_ext:this.ext,this.ext=+p.get("settings.isPage")?e.file_page_ext:this.ext,this.ext=+p.get("settings.isGroup")?e.file_group_ext:this.ext,this.ext=+p.get("settings.isEvent")?e.file_event_ext:this.ext,{container:"joms-postbox-file-upload",drop_element:"joms-postbox-file--droparea",browse_button:"joms-postbox-file-upload-btn",url:t,filters:[{title:"File files",extensions:this.ext}],max_file_size:this.maxFileSize+"mb"});return d.mobile||(i.resize={width:2100,height:2100,quality:90}),this.uploader=new n(i),this.uploader.onAdded=d.bind(this.onFileAdded,this),this.uploader.onError=d.bind(this.onFileError,this),this.uploader.onProgress=d.bind(this.onFileProgress,this),this.uploader.onUploaded=d.bind(this.onFileUploaded,this),this.uploader.init(),d.ie&&(this.$uploader.hide(),this.$uploader.appendTo(this.$uploaderParent)),this},showInitialState:function(){this.$main.hide(),this.$initial.show(),d.ie&&d.ieVersion<10&&this.ieUploadButtonFix(!0),this.inputbox&&this.inputbox.single(),this.preview&&this.preview.remove(),this.preview=!1,this.showMoreButton(),s.prototype.showInitialState.apply(this)},showMainState:function(){s.prototype.showMainState.apply(this),this.$action.hide(),this.$initial.hide(),this.$main.show(),this.$save.show(),d.ie&&d.ieVersion<10&&this.ieUploadButtonFix(),t.postbox&&t.postbox.value&&t.postbox.value.length&&(this.inputbox.set(t.postbox.value[0]),t.postbox.value=!1)},showMoreButton:function(){this.$tabupload.removeClass("hidden invisible")},hideMoreButton:function(){this.$tabupload.addClass(this.subviews.mood?"hidden":"invisible")},reset:function(){s.prototype.reset.apply(this),this.inputbox&&this.inputbox.reset(),this.preview&&this.preview.remove(),this.preview=!1,this.uploading=[]},value:function(){var t,e;for(e in this.data.text=this.inputbox.value()||"",this.data.attachment={},this.data.text=this.data.text.replace(/\n/g,"\\n"),this.subflags)(t=this.subviews[e].value())&&(this.data.attachment[e]=t);return this.preview&&d.extend(this.data.attachment,this.preview.value()),s.prototype.value.apply(this,arguments)},validate:function(){var t=this.value(!0)[1]||{};if(!t.id&&t.id.length)return"No image selected."},onPrivacySelect:function(t){var e=(e=this.$tabprivacy.find("use").attr("xlink:href")).replace(/#.+$/,"#joms-icon-"+t.icon);this.$tabprivacy.find("use").attr("xlink:href",e),this.$tabprivacy.find("span").html(t.label)},onFileAdd:function(){var t,e,i;this.uploading.length||(t=+(i=p.get("conf")||{}).limitfile,e=+i.uploadedfile,+i.num_file_per_upload<=(i=this.preview?this.preview.getNumFiles():0)?window.alert(u.get("file.batch_notice")):t<=(e+=i)?window.alert(u.get("photo.upload_limit_exceeded")||"You have reached the upload limit."):window.opera||d.ie&&10===d.ieVersion?this.$("#joms-postbox-photo-upload").find("input[type=file]").click():this.uploader.open())},onFileAdded:function(e,t){if(!this.uploading.length&&t&&t.length){var i=this.ext,s=this.maxFileSize,o=(t=_.filter(t,function(t){t=t.name.split(".").pop();return _.contains(i.split(","),t)}),t=_.filter(t,function(t){return t.size<=1024*s*1024}),p.get("conf")||{}),n=+o.num_file_per_upload,a=+o.limitfile,o=+o.uploadedfile,l=this.preview?this.preview.getNumFiles():0,r=this;if(l+t.length>n)window.alert(u.get("file.batch_notice")),_.each(t,function(t){e.removeFile(t)});else if(a<=(o+=l))window.alert(u.get("photo.upload_limit_exceeded")||"You have reached the upload limit."),_.each(t,function(t){e.removeFile(t)});else{o+t.length>a&&(n=o+t.length-a,t.splice(0-n,n),e.splice(0-n,n)),this.preview||(l=d("<div>").appendTo(this.$preview),this.preview=new c,this.assign(l,this.preview),this.listenTo(this.preview,"update",function(t){!t||t<=0?(this.showInitialState(),this.inputbox.single(),this.uploading=[]):(8<=t?this.hideMoreButton():this.showMoreButton(),this.inputbox[1<t?"multiple":"single"]())})),this.showMainState();for(var h=0;h<t.length;h++)this.preview.add(t[h]);_.each(t,function(t){r.uploading.push(t.id)}),this.$action.hide(),e.start(),e.refresh()}}},onFileError:function(t,e){var i;+e.code==+plupload.FILE_EXTENSION_ERROR?window.alert(u.get("file.file_type_not_permitted")):+e.code==+plupload.FILE_SIZE_ERROR?(i='"'+e.file.name+'": '+u.get("file.max_upload_size_error").replace("##maxsize##",this.maxFileSize),window.alert(i)):console.log(e.message)},onFileProgress:function(t,e){this.preview&&this.preview.updateProgress(e)},onFileUploaded:function(t,e,i){var s;try{s=JSON.parse(i.response)}catch(t){}(s=s||{}).id?(this.uploading=_.without(this.uploading,e.id),0===this.uploading.length&&this.$action.show(),this.preview&&this.preview.setFile(e,s)):(t.stop(),t.splice(),window.alert(s&&s.msg||"Undefined error."),this.uploading=[],this.$action.show(),this.preview&&this.preview.removeFailed())},onDragEnter:function(t){t.preventDefault(),this.$dropArea.show(),this.$dropArea.css("line-height",this.$dropArea.height()+"px")},onDragLeave:function(t){t.preventDefault(),this.$dropArea.hide()},onFileDrop:function(t){t.preventDefault(),this.$dropArea.hide()},onMoodSelect:function(t){this.inputbox.updateAttachment(t)},onMoodRemove:function(){this.inputbox.updateAttachment(!1)},getStaticAttachment:function(){return this.staticAttachment||(this.staticAttachment=d.extend({},p.get("postbox.attachment")||{},{type:"file"})),this.staticAttachment},ieUploadButtonFix:function(t){this.ieUploadButtonFix.init||(this.ieUploadButtonFix.init=!0,this.$uploader.css({display:"block",position:"absolute",opacity:0,width:"",height:""}).children("button,form").css({display:"block",position:"absolute",width:"",height:"",top:0,right:0,bottom:0,left:0}).children("input").css({cursor:"pointer",height:"100%"})),t?(this.$uploader.appendTo(this.$uploaderParent),this.$uploader.css({top:12,right:12,bottom:12,left:12}).children("form").css({width:"100%",height:"100%"})):(this.$uploader.appendTo(this.$tabupload),this.$uploader.css({top:0,right:0,bottom:0,left:0}))}})}),define("views/inputbox/poll",["views/inputbox/videourl","sandbox","utils/language"],function(t,e,i){return t.extend({getTemplate:function(){var t=i.get("poll.title_hint")||"Poll title",t=this.template({placeholder:t});return e(t)}})}),define("views/postbox/poll-options",["sandbox","views/base","utils/language"],function(i,t,e){return t.extend({template:{list:_.template('<div class="joms-postbox__poll-option-list"></div>                <a href="javascript:;" class="joms-postbox-poll__add-option">+ <%= language.add_option %></a>'),option:_.template('<div class="joms-postbox__poll-option">                    <input class="input-option poll_option" type="text" name="poll_options[]" placeholder="<%= language.hint_add_option %>" maxlength="100">                    <a href="javascript:;" class="joms-postbox-poll__remove-option">                        <svg viewBox="0 0 16 16" class="joms-icon">                            <use xlink:href="<%= window.joms_current_url %>#joms-icon-close"></use>                        </svg>                    </a>                </div>')},getTemplate:function(t){t=this.template[t]({language:e.get("poll")});return i(t)},render:function(){this.$el.html(this.getTemplate("list")),this.$list=this.$el.find(".joms-postbox__poll-option-list"),this.$list.append(this.getTemplate("option")),this.$list.append(this.getTemplate("option"))},events:i.extend({},t.prototype.events,{"click .joms-postbox-poll__remove-option":"removeOption","click .joms-postbox-poll__add-option":"addOption"}),removeOption:function(t){i(t.currentTarget).parents(".joms-postbox__poll-option").remove()},addOption:function(t){this.$list.append(this.getTemplate("option")),this.$list.find("input").last().focus()},reset:function(){this.$el.html(""),this.render()},value:function(){var t=this.$list.find(".input-option"),e=[];return t.each(function(){var t=i(this).val();t&&e.push(t)}),{options:e}}})}),define("views/postbox/poll-settings",["sandbox","views/base","utils/language"],function(e,t,i){return t.extend({template:_.template('\x3c!--<div class="settings-item">                <input type="checkbox" name="allow_add">                <span style="cursor:pointer" class="settings-item--label">Allow any one to add options</span>            </div>--\x3e            <div class="settings-item">                <input type="checkbox" name="allow_multiple">                <span style="cursor:pointer" class="settings-item--label"><%= language.allow_multiple_choices %></span>            </div>'),getTemplate:function(){var t=this.template({language:i.get("poll")});return e(t)},render:function(){this.$el.html(this.getTemplate())},events:e.extend({},t.prototype.events,{"click .settings-item--label":"toggleCheckbox"}),toggleCheckbox:function(t){t=e(t.currentTarget).siblings("input[type=checkbox]");t.prop("checked",!t.prop("checked"))},reset:function(){this.$el.html(""),this.render()},value:function(){var t=this.$el.find("input[name=allow_add]"),e=this.$el.find("input[name=allow_multiple]");return{settings:{allow_add:t.prop("checked"),allow_multiple:e.prop("checked")}}}})}),define("views/postbox/poll-time",["sandbox","views/base","utils/constants","utils/language"],function(n,t,a,l){return t.extend({template:_.template('<div class="joms-postbox__poll-time--inner">                <span>                    <%= language.poll.expired_date %> <span style="color:red">*</span>                </span>                <input type=text class="joms-input joms-pickadate-enddate" placeholder=" <%= language.poll.epxired_date_hint %>" style="background-color:transparent;cursor:text">                <span>                    <%= language.poll.expired_time %> <span style="color:red">*</span>                </span>                <input type=text class="joms-input joms-pickadate-endtime" placeholder=" <%= language.poll.expired_time_hint %>" style="background-color:transparent;cursor:text">            </div>'),events:{},render:function(){var t,e=this.getTemplate(),i=+a.get("conf.eventshowampm"),s=+a.get("conf.firstday"),i=i?"h:i A":"H:i",o={};for(o.monthsFull=[l.get("datepicker.january"),l.get("datepicker.february"),l.get("datepicker.march"),l.get("datepicker.april"),l.get("datepicker.may"),l.get("datepicker.june"),l.get("datepicker.july"),l.get("datepicker.august"),l.get("datepicker.september"),l.get("datepicker.october"),l.get("datepicker.november"),l.get("datepicker.december")],o.monthsShort=[],t=0;t<o.monthsFull.length;t++)o.monthsShort[t]=o.monthsFull[t].substr(0,3);for(o.weekdaysFull=[l.get("datepicker.sunday"),l.get("datepicker.monday"),l.get("datepicker.tuesday"),l.get("datepicker.wednesday"),l.get("datepicker.thursday"),l.get("datepicker.friday"),l.get("datepicker.saturday")],o.weekdaysShort=[],t=0;t<o.weekdaysFull.length;t++)o.weekdaysShort[t]=o.weekdaysFull[t].substr(0,3);return o.today=l.get("datepicker.today"),o.clear=l.get("datepicker.clear"),o.firstDay=s,o.selectYears=200,o.selectMonths=!0,this.$el.html(e),this.$enddate=this.$(".joms-pickadate-enddate").pickadate(n.extend({},o,{format:"d mmmm yyyy",klass:{frame:"picker__frame endDate"},min:!0})),this.$endtime=this.$(".joms-pickadate-endtime").pickatime({interval:15,format:i,formatLabel:i,klass:{frame:"picker__frame endTime"}}),this.enddate=this.$enddate.pickadate("picker"),this.endtime=this.$endtime.pickatime("picker"),this.enddate.on({set:n.bind(this.onSetEndDate,this)}),this.endtime.on({set:n.bind(this.onSetEndTime,this)}),this},value:function(){return!this.$enddate.val()&&this.data&&(this.data.enddate=null),!this.$endtime.val()&&this.data&&(this.data.endtime=null),this.data},reset:function(){this.data=null,this.$enddate.val(""),this.$endtime.val("")},onSetEndDate:function(t){this.onSave()},onSetEndTime:function(){this.onSave()},onSave:function(){var t=this.enddate.get("select"),e=this.endtime.get("select"),t=t&&[this.enddate.get("select","yyyy-mm-dd"),this.enddate.get("value")],e=e&&[this.endtime.get("select","HH:i"),this.endtime.get("value")];this.data={enddate:t,endtime:e},this.$enddate.val()?this.$enddate.css("border-color",""):this.$enddate.css("border-color","#ec0000"),this.$endtime.val()?this.$endtime.css("border-color",""):this.$endtime.css("border-color","#ec0000"),this.trigger("select",this.data)},getTemplate:function(){var t=this.template({language:{event:l.get("event")||{},poll:l.get("poll")||{}}});return n(t)}})}),define("views/postbox/poll",["sandbox","app","views/postbox/default","views/inputbox/poll","views/widget/select","views/postbox/poll-options","views/postbox/poll-settings","views/postbox/poll-time","views/dropdown/privacy","utils/constants","utils/language"],function(i,t,s,o,n,a,l,r,e,h,d){return s.extend({subviews:{privacy:e},template:_.template('<div class="joms-postbox-poll">                <div class="joms-postbox-inner-panel">                    <div class="joms-postbox-inputbox" style=""></div>                 </div>                <div class="joms-postbox-inner-panel">                    <div class=joms-postbox-poll-options></div>                    <div class=joms-postbox-poll-settings></div>                    <div class="joms-postbox-poll-category joms-fetched-category joms-select"></div>                    <div class="joms-postbox__poll-time"></div>                </div>                <nav class="joms-postbox-tab selected">                     <ul class="joms-list inline">                         <li data-tab=privacy>                            <svg viewBox="0 0 16 18" class="joms-icon"><use xlink:href="<%= window.joms_current_url %>#joms-icon-earth"></use></svg>                             <span class=visible-desktop></span>                        </li>                    </ul>                     <div class=joms-postbox-action>                         <button class=joms-postbox-cancel><%= language.postbox.cancel_button %></button>                         <button class=joms-postbox-save><%= language.postbox.post_button %></button>                     </div>                     <div class=joms-postbox-loading style="display:none;">                         <img src="<%= juri.root%>components/com_community/assets/ajax-loader.gif" alt="loader">                     </div>                 </nav>            </div>'),getTemplate:function(){var t=this.template({juri:h.get("juri"),language:{postbox:d.get("postbox")||{}}});return i(t).hide()},initialize:function(){var t=h.get("settings")||{};(this.inheritPrivacy=t.isPage||t.isGroup||t.isEvent||!t.isMyProfile)&&(this.subviews=i.omit(this.subviews,"privacy")),s.prototype.initialize.apply(this)},render:function(){s.prototype.render.apply(this),this.$inputbox=this.$(".joms-postbox-inputbox"),this.$tabprivacy=this.$tabs.find("[data-tab=privacy]"),this.$tabpolltime=this.$tabs.find("[data-tab=polltime]"),this.$options=this.$(".joms-postbox-poll-options"),this.$settings=this.$(".joms-postbox-poll-settings"),this.$category=this.$(".joms-postbox-poll-category"),this.$polltime=this.$(".joms-postbox__poll-time"),this.inheritPrivacy&&(this.$tabprivacy.next().length?this.$tabprivacy.remove():this.$tabprivacy.css({visibility:"hidden"})),this.inputbox=new o({attachment:!0,charcount:!0}),this.assign(this.$inputbox,this.inputbox),this.listenTo(this.inputbox,"focus",this.onInputFocus),this.listenTo(this.inputbox,"keydown",this.onInputUpdate),this.listenTo(this.inputbox,"paste",this.onInputUpdate);var t,e=this.sortCategories(h.get("pollCategories")).map(function(t){return[t.id,t.name]});return this.category=new n({options:e}),this.assign(this.$category,this.category),this.options=new a,this.assign(this.$options,this.options),this.settings=new l,this.assign(this.$settings,this.settings),this.polltime=new r,this.assign(this.$polltime,this.polltime),this.inheritPrivacy||((e=h.get("settings")||{}).isProfile&&e.isMyProfile&&(t=h.get("conf.profiledefaultprivacy")),this.initSubview("privacy",{privacylist:window.joms_privacylist,defaultPrivacy:t||"public"})),this.single&&this.listenTo(i,"click",this.onDocumentClick),this},reset:function(){s.prototype.reset.apply(this),this.inputbox&&this.inputbox.reset(),this.options&&this.options.reset(),this.settings&&this.settings.reset(),this.polltime&&this.polltime.reset(),this.staticAttachment=null},value:function(){var t,e;for(e in this.data.text=this.inputbox.value()||"",this.data.text=this.data.text.replace(/\n/g,"\\n"),this.data.attachment={},this.data.attachment.polltime=this.polltime.value(),this.subflags)(t=this.subviews[e].value())&&(this.data.attachment[e]=t);return this.data.attachment.catid=this.category.value(),s.prototype.value.apply(this)},validate:function(){var t=this.options.value(),e=this.inputbox.value(),i=this.category.value(),s=this.polltime.value(),o=d.get("poll");return e.trim()?t.options.length<2?o.not_enough_option:i?s&&s.enddate?s.endtime?null:o.no_expiry_time:o.no_expiry_date:o.no_category:o.no_title},onInputFocus:function(){this.showMainState()},onInputUpdate:function(t,e){this.togglePostButton(t=t||"")},onPrivacySelect:function(t){var e=(e=this.$tabprivacy.find("use").attr("xlink:href")).replace(/#.+$/,"#joms-icon-"+t.icon);this.$tabprivacy.find("use").attr("xlink:href",e),this.$tabprivacy.find("span").html(t.label)},sortCategories:function(t,e,i){if(!t||!t.length)return[];e=e||0,i=i||"";for(var s,o,n=[],a=0;a<t.length;a++)+t[a].parent===e&&(s=+t[a].id,o=i+t[a].name,n.push({id:s,name:o}),n=n.concat(this.sortCategories(t,s,o+" &rsaquo; ")));return n},getStaticAttachment:function(){return this.staticAttachment||(this.staticAttachment=i.extend({},h.get("postbox.attachment")||{},{type:"poll"},this.options.value(),this.settings.value())),this.staticAttachment},togglePostButton:function(t){t=!!t;!(t=!t&&this.subflags.mood?this.subviews.mood.value():t)&&this.subflags.location&&(t=this.subviews.location.value()),this.$save[t?"show":"hide"]()}})}),define("views/postbox/custom",["sandbox","views/postbox/default","views/dropdown/privacy","utils/ajax","utils/constants","utils/language"],function(o,e,t,i,n,a){return e.extend({subviews:{privacy:t},template:joms.jst["html/postbox/custom"],events:o.extend({},e.prototype.events,{"click .joms-postbox-predefined-message":"onCustomPredefined","click .joms-postbox-custom-message":"onCustomCustom","keyup [name=custom]":"onTextareaUpdate"}),initialize:function(){var t=n.get("settings")||{};(this.inheritPrivacy=t.isPage||t.isGroup||t.isEvent||!t.isMyProfile)&&(this.subviews=o.omit(this.subviews,"privacy")),e.prototype.initialize.apply(this),this.attachment={type:"custom"},o.extend(this.attachment,n.get("postbox.attachment")||{})},render:function(){return e.prototype.render.apply(this),this.$initial=this.$el.children(".joms-postbox-inner-panel"),this.$main=this.$el.children(".joms-postbox-custom"),this.$statepredefined=this.$(".joms-postbox-custom-state-predefined"),this.$statecustom=this.$(".joms-postbox-custom-state-custom"),this.$predefined=this.$("[name=predefined]"),this.$custom=this.$("[name=custom]"),this.$divs=this.$(".joms-postbox-dropdown").hide(),this.$tabprivacy=this.$tabs.find("[data-tab=privacy]"),this.inheritPrivacy&&this.$tabprivacy.css({visibility:"hidden"}),this.inheritPrivacy||(this.initSubview("privacy",{privacylist:["public","site_members"]}),this.subviews.privacy.setPrivacy("public")),this},showInitialState:function(){this.$main.hide(),this.$initial.show(),e.prototype.showInitialState.apply(this)},showMainState:function(t){e.prototype.showMainState.apply(this),t?this.showPredefinedState():this.showCustomState()},showPredefinedState:function(){this.$initial.hide(),this.$statepredefined.show(),this.$statecustom.hide(),this.$main.show(),this.$save.show(),this.predefined=!0},showCustomState:function(){this.$initial.hide(),this.$statepredefined.hide(),this.$statecustom.show(),this.$main.show(),this.predefined=!1},reset:function(){e.prototype.reset.apply(this),this.$predefined&&this.$predefined.val(this.$predefined.find("option:first").val()),this.$custom&&this.$custom.val("")},value:function(){var t=[];return this.predefined?(t.push(this.$predefined.val()),t.push(this.$predefined.find("option:selected").text())):(t.push("system.message"),t.push(this.$custom.val().replace(/\n/g,"\\n"))),"privacy"in this.subflags&&t.push(this.subviews.privacy.value()),t},validate:function(){var t,e=this.value();return this.predefined?e[0]||(t="Predefined message cannot be empty."):e[1]||(t="Custom message cannot be empty."),t},onTextareaUpdate:function(){var t=(t=this.$custom.val()).replace(/^\s+|\s+$/g,"");this.$save[t?"show":"hide"]()},onCustomPredefined:function(){this.showMainState("predefined")},onCustomCustom:function(){this.showMainState()},onPost:function(){var t,e;this.saving||((t=this.validate())?window.alert(t):(this.saving=!0,this.$loading.show(),i({fn:"activities,ajaxAddPredefined",data:(e=this).value(),success:o.bind(this.onPostSuccess,this),complete:function(){e.$loading.hide(),e.saving=!1,e.showInitialState()}})))},onPrivacySelect:function(t){var e=(e=this.$tabprivacy.find("use").attr("xlink:href")).replace(/#.+$/,"#joms-icon-"+t.icon);this.$tabprivacy.find("use").attr("xlink:href",e),this.$tabprivacy.find("span").html(t.label)},getTemplate:function(){var t,e=n.get("customActivities")||{},i=[];for(t in e)i.push([t,e[t]]);var s=this.template({juri:n.get("juri"),messages:i,language:{postbox:a.get("postbox"),custom:a.get("custom")}});return o(s).hide()}})}),define("views/postbox/layout",["sandbox","views/base","views/postbox/status","views/postbox/photo","views/postbox/video","views/postbox/event","views/postbox/file","views/postbox/poll","views/postbox/custom","utils/constants","utils/language"],function(s,t,e,i,o,n,a,l,r,h,d){return t.extend({subflags:{},subviews:{status:e,photo:i,video:o,event:n,file:a,poll:l,custom:r},events:{"click .joms-postbox-tab-root li":"onChangeTab"},initialize:function(){this.listenTo(s,"postbox:status",this.onOpenStatusTab),this.listenTo(s,"postbox:photo",this.onOpenPhotoTab),this.listenTo(s,"postbox:video",this.onOpenVideoTab),this.listenTo(s,"postbox:file",this.onOpenFileTab),this.listenTo(s,"postbox:poll",this.onOpenPollTab)},render:function(){var t=h.get("settings")||{},e=h.get("conf")||{},i=(t.isAdmin&&e.enablecustoms||(this.subviews=s.omit(this.subviews,"custom")),t.isProfile&&!t.isMyProfile&&(this.subviews=s.pick(this.subviews,"status","photo","video","file","poll")),t.isEvent&&(this.subviews=s.omit(this.subviews,"event")),(t.isProfile||t.isGroup||t.isEvent||t.isPage)&&(e.enablephotos||(this.subviews=s.omit(this.subviews,"photo")),e.enablevideos||(this.subviews=s.omit(this.subviews,"video")),e.enableevents||(this.subviews=s.omit(this.subviews,"event")),e.enablefiles||(this.subviews=s.omit(this.subviews,"file")),e.enablepolls||(this.subviews=s.omit(this.subviews,"poll"))),this.subkeys=s.keys(this.subviews),this.$subviews=this.$(".joms-postbox-tabs"),this.$tab=this.$(".joms-postbox-tab-root").hide(),this);this.$tab.find("li").each(function(){var t=s(this),e=t.data("tab");i.subkeys.indexOf(e)<0&&t.remove()}),this.subkeys&&this.subkeys.length&&this.changeTab(this.subkeys[0])},show:function(){this.$el[s.isMobile?"show":"fadeIn"]()},changeTab:function(t){if(this.subviews[t]){var e,i=this.$tab.find("li[data-tab="+t+"]");for(e in i&&i.length&&(i.hasClass("active")||i.addClass("active"),i.siblings(".active").removeClass("active")),this.subflags[t]||this.initSubview(t),this.subflags)e!==t&&this.subviews[e].hide();this.subviews[t].show(),this.type=t,s.trigger("postbox:tab:change",t)}},onChangeTab:function(t){this.changeTab(s(t.currentTarget).data("tab"))},onOpenStatusTab:function(){this.changeTab("status")},onOpenPhotoTab:function(){this.changeTab("photo")},onOpenVideoTab:function(){this.changeTab("video")},onOpenFileTab:function(){this.changeTab("file")},onOpenPollTab:function(){this.changeTab("poll")},onShowInitialState:function(){1<this.subkeys.length&&this.$tab.show()},onShowMainState:function(){this.$tab.hide()},initSubview:function(t){this.subflags[t]||(this.subviews[t]=new this.subviews[t]({single:this.subkeys.length<=1}),this.assign(this.getSubviewElement(),this.subviews[t]),this.listenTo(this.subviews[t],"show:initial",this.onShowInitialState),this.listenTo(this.subviews[t],"show:main",this.onShowMainState),this.subflags[t]=!0)},getSubviewElement:function(){return s("<div>").hide().appendTo(this.$subviews)}})}),define("views/stream/filterbar",["sandbox","views/base","utils/ajax"],function(o,t,n){return t.extend({render:function(){this.$btn=o(".joms-activity-filter-action"),this.$list=o(".joms-activity-filter-dropdown"),this.$options=o(".joms-activity-filter__options"),this.$btn.on("click",o.bind(this.toggle,this)),this.$list.on("click","li",o.bind(this.select,this)),this.$list.on("change","select",o.bind(this.filterChange,this)),this.$list.on("keyup","input[type=text]",o.bind(this.filterKeyup,this)),this.$list.on("click","button.joms-button--primary",o.bind(this.filterSearch,this)),this.$options.find("li").not(".noselect").addClass("joms-js-filterbar-item"),o(document).on("click",".joms-js-filterbar-item",o.bind(this.makeDefault,this)),this.listenTo(o,"click",this.onDocumentClick)},toggle:function(){"none"===this.$list[0].style.display?this.expand():this.collapse()},expand:function(){this.$list.show()},collapse:function(){this.$list.hide()},select:function(t){var t=o(t.currentTarget),e=t.data("url")||"/";"__filter__"!==t.data("filter")&&(this.toggle(),window.location=e)},filterChange:function(t){var t=t.target.value,e=this.$list.find("input[type=text]"),i=this.$list.find(".joms-button--primary");"hashtag"!==t&&"keyword"!==t||(e.attr("placeholder",e.data("label-"+t)),i.html(i.data("label-"+t)))},filterKeyup:function(t){var t=o(t.currentTarget),e=t.val(),i=e;(i=e.replace(/#/g,"")).length!==e.length&&t.val(i)},filterSearch:function(t){var e,i;t.preventDefault(),t.stopPropagation(),e=(t=o(t.currentTarget).closest("li")).find("select").val(),(i=t.find("input").val().replace(/^\s+|\s+$/g,""))&&("hashtag"===e&&(i=(i=i.split(" "))[0]),t=(t=(t=t.data("url")).replace("__filter__",e)).replace("__value__",i),window.location=t)},makeDefault:function(t){var e,i,s;t.preventDefault(),t.stopPropagation(),t=(e=o(t.currentTarget)).find("a").data("value"),"hidden"===(i=this.$options.find(".noselect > img")).css("visibility")&&(i.css("visibility","visible"),s={},n({fn:"system,ajaxDefaultUserStream",data:[t],success:function(t){t&&(s=t)},complete:o.bind(function(){s.error?joms.popup.info("Error",s.error):s.success&&(joms.popup.info("",s.message),this.$options.find(".joms-dropdown").hide(),e.addClass("active").siblings("li").removeClass("active"),i.css("visibility","hidden"))},this)}))},onDocumentClick:function(t){t.closest(".joms-activity-filter").length||this.collapse()}})}),define("views/stream/layout",["sandbox","views/base","views/stream/filterbar"],function(t,e,i){return e.extend({initialize:function(){this.filterbar=new i},render:function(){this.filterbar.render()}})}),window.joms_init_postbox=function(){require(["jst","sandbox","views/postbox/layout","views/stream/layout","utils/constants"],function(t,e,i,s,o){var n;(e=e(".joms-postbox")).length&&((e=new i({el:e})).render(),e.show()),(new s).render(),+window.joms_my_id&&(o.set("friends","fetching"),n=window.setInterval(function(){window.joms_friends&&(window.clearInterval(n),o.set("friends",window.joms_friends))},200))})},define("bundle",function(){})}();